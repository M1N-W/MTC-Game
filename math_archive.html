<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Math Explorer Pro + Gemini AI</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Thai:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']]
            },
            options: {
                ignoreHtmlClass: 'tex2jax_ignore',
                processHtmlClass: 'tex2jax_process'
            },
            startup: {
                typeset: false // ‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡∏™‡∏±‡πà‡∏á typeset ‡πÄ‡∏≠‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏°‡∏≤
            }
        };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <style>
        body {
            font-family: 'Noto Sans Thai', sans-serif;
            background-color: #fcfbf9;
            color: #4a4a4a;
            -webkit-font-smoothing: antialiased;
        }

        /* Card Animations */
        .symbol-card {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .symbol-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 20px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.05);
            border-color: #f59e0b;
        }

        /* Quiz Mode Effects */
        .quiz-mode .meaning, .quiz-mode .name-en, .quiz-mode .desc-text {
            filter: blur(8px);
            opacity: 0.2;
            transition: all 0.3s ease;
            user-select: none;
        }
        .quiz-mode .symbol-card:hover .meaning, 
        .quiz-mode .symbol-card:hover .name-en, 
        .quiz-mode .symbol-card:hover .desc-text {
            filter: blur(0);
            opacity: 1;
            user-select: auto;
        }

        /* Chart Container */
        .chart-container {
            position: relative;
            width: 100%;
            height: 300px;
        }

        /* AI Content Styling - ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö marked.js output */
        .ai-content h1, .ai-content h2, .ai-content h3 { color: #92400e; font-weight: 700; margin-top: 1em; margin-bottom: 0.5em; }
        .ai-content h1 { font-size: 1.2em; }
        .ai-content h2 { font-size: 1.1em; }
        .ai-content h3 { font-size: 1em; border-bottom: 1px solid #fde68a; padding-bottom: 0.2em; }
        .ai-content ul { list-style-type: disc; margin-left: 1.5rem; margin-bottom: 0.75rem; }
        .ai-content ol { list-style-type: decimal; margin-left: 1.5rem; margin-bottom: 0.75rem; }
        .ai-content li { margin-bottom: 0.35rem; line-height: 1.6; }
        .ai-content li > ul, .ai-content li > ol { margin-top: 0.25rem; margin-bottom: 0.25rem; }
        .ai-content strong { font-weight: 700; color: #b45309; }
        .ai-content em { font-style: italic; color: #57534e; }
        .ai-content p { margin-bottom: 0.75rem; line-height: 1.7; }
        .ai-content code { background: #f5f5f4; color: #e11d48; padding: 0.1em 0.4em; border-radius: 4px; font-size: 0.85em; font-family: monospace; }
        .ai-content pre { background: #1c1917; color: #e7e5e4; padding: 1rem; border-radius: 8px; overflow-x: auto; margin-bottom: 0.75rem; }
        .ai-content pre code { background: transparent; color: inherit; padding: 0; }
        .ai-content blockquote { border-left: 3px solid #f59e0b; padding-left: 1rem; color: #78716c; margin: 0.75rem 0; font-style: italic; }
        .ai-content hr { border-color: #e7e5e4; margin: 1rem 0; }
        .ai-content table { width: 100%; border-collapse: collapse; margin-bottom: 0.75rem; font-size: 0.85em; }
        .ai-content th { background: #fef3c7; padding: 0.5rem; text-align: left; font-weight: 700; border: 1px solid #fde68a; }
        .ai-content td { padding: 0.4rem 0.5rem; border: 1px solid #e7e5e4; }
        
        /* Loading Animation */
        .loading-dots:after {
            content: ' .';
            animation: dots 1.5s steps(5, end) infinite;
        }
        @keyframes dots {
            0%, 20% { content: ' .'; }
            40% { content: ' ..'; }
            60% { content: ' ...'; }
            80%, 100% { content: ' ....'; }
        }

        mjx-container { font-size: 110% !important; }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #d6d3d1; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #a8a29e; }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <header class="bg-white/90 backdrop-blur-md border-b border-stone-200 sticky top-0 z-30 shadow-sm transition-all duration-300">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-3">
            <div class="flex flex-col md:flex-row justify-between items-center gap-4">
                <div class="flex items-center gap-2 cursor-pointer" onclick="window.scrollTo({top:0, behavior:'smooth'})">
                    <span class="text-3xl filter drop-shadow-sm">üìê</span>
                    <div>
                        <h1 class="text-xl font-bold text-stone-800 leading-none">Math Explorer Pro</h1>
                        <p class="text-[10px] uppercase tracking-widest text-amber-600 font-bold mt-1">AI Integrated System ‚ú®</p>
                    </div>
                </div>
                <div class="flex items-center gap-3">
                    <button id="quizToggle" class="flex items-center gap-2 px-4 py-2 rounded-xl bg-stone-100 hover:bg-stone-200 text-stone-600 font-semibold transition-all text-xs border border-stone-200 shadow-sm active:scale-95">
                        <span id="quizIcon">üëÅÔ∏è</span>
                        <span id="quizText">‡πÇ‡∏´‡∏°‡∏î‡∏ó‡πà‡∏≠‡∏á‡∏à‡∏≥ (Quiz Mode)</span>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <main class="flex-grow max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 w-full space-y-8">
        <section class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <div class="lg:col-span-2 bg-gradient-to-br from-amber-50 to-orange-50 border border-amber-100 p-6 rounded-2xl shadow-sm relative overflow-hidden group hover:shadow-md transition-all">
                <div class="relative z-10">
                    <h2 class="text-xl font-bold text-amber-900 mb-2 flex items-center gap-2">
                        <span>‚ú®</span> ‡∏¢‡∏Å‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡∏î‡πâ‡∏ß‡∏¢ Gemini AI
                    </h2>
                    <p class="text-amber-800/80 text-sm leading-relaxed mb-4 max-w-lg">
                        ‡πÅ‡∏≠‡∏õ‡∏û‡∏•‡∏¥‡πÄ‡∏Ñ‡∏ä‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πâ‡∏Ç‡∏∏‡∏°‡∏û‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å <strong>Gemini 2.5 flash</strong> ‡∏ä‡πà‡∏ß‡∏¢‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏™‡∏±‡∏ç‡∏•‡∏±‡∏Å‡∏©‡∏ì‡πå‡∏ó‡∏≤‡∏á‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå ‡∏ô‡πâ‡∏≠‡∏á‡πÜ ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏´‡∏°‡∏î "‡∏ñ‡∏≤‡∏° AI" ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢ ‡∏´‡∏£‡∏∑‡∏≠‡πÇ‡∏à‡∏ó‡∏¢‡πå‡∏ó‡πâ‡∏≤‡∏ó‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
                    </p>
                    <div class="flex flex-wrap gap-2">
                        <span class="px-3 py-1 bg-white/60 rounded-full text-[11px] font-bold text-amber-700 border border-amber-200 shadow-sm">üöÄ ‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏á‡πà‡∏≤‡∏¢</span>
                        <span class="px-3 py-1 bg-white/60 rounded-full text-[11px] font-bold text-amber-700 border border-amber-200 shadow-sm">üí° ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏à‡∏£‡∏¥‡∏á</span>
                        <span class="px-3 py-1 bg-white/60 rounded-full text-[11px] font-bold text-amber-700 border border-amber-200 shadow-sm">üî• ‡πÇ‡∏à‡∏ó‡∏¢‡πå‡∏ó‡πâ‡∏≤‡∏ó‡∏≤‡∏¢</span>
                    </div>
                </div>
                <div class="absolute -bottom-6 -right-6 opacity-10 text-9xl grayscale transition-transform group-hover:scale-110 group-hover:rotate-12 duration-500">ü§ñ</div>
            </div>
            
            <div class="bg-white border border-stone-200 p-6 rounded-2xl shadow-sm flex flex-col justify-center items-center text-center hover:shadow-md transition-all">
                <p class="text-xs text-stone-400 uppercase font-bold tracking-tighter mb-2">AI Curriculum Creator</p>
                <h3 id="roadmapTitle" class="text-lg font-bold text-stone-800 mb-3">‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ ‚ú®</h3>
                <button onclick="generateRoadmap()" id="categoryRoadmapBtn" class="w-full py-2.5 px-4 bg-stone-800 hover:bg-stone-900 text-white rounded-xl text-sm font-bold transition-all flex items-center justify-center gap-2 group shadow-lg shadow-stone-200">
                    <span class="group-hover:rotate-12 transition-transform">‚ú®</span> ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡∏ï‡∏¥‡∏ß‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏ô‡∏µ‡πâ
                </button>
            </div>
        </section>

        <section id="roadmapSection" class="hidden transform transition-all duration-300">
            <div class="bg-stone-900 text-stone-200 p-6 rounded-2xl shadow-xl border border-stone-800 relative overflow-hidden">
                <div class="absolute top-0 right-0 p-4 opacity-10 text-6xl">üó∫Ô∏è</div>
                <div class="flex justify-between items-start mb-4 relative z-10">
                    <h3 class="text-lg font-bold text-amber-400 flex items-center gap-2">
                        <span>üöÄ</span> AI Roadmap: <span id="roadmapCategoryName" class="text-white">General</span>
                    </h3>
                    <button onclick="closeRoadmap()" class="text-stone-400 hover:text-white transition-colors bg-stone-800 p-1 rounded-full w-8 h-8 flex items-center justify-center">‚úï</button>
                </div>
                <div id="roadmapResult" class="text-sm leading-relaxed space-y-3 relative z-10 ai-content text-stone-300"></div>
            </div>
        </section>

        <section class="bg-white border border-stone-200 p-5 rounded-2xl shadow-sm">
            <div class="flex items-center justify-between mb-4">
                <h2 class="text-base font-bold text-stone-800 flex items-center gap-2">
                    <span>üîç</span> ‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà + ‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤
                </h2>
                <span id="modelLabel" class="text-[9px] font-bold bg-green-100 text-green-700 px-2.5 py-1 rounded-full border border-green-200">GEMINI ACTIVE</span>
            </div>
            <div class="space-y-3">
                <div id="categoryContainer" class="flex flex-wrap gap-2"></div>
                <div class="relative">
                    <input id="searchInput" type="text" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏™‡∏±‡∏ç‡∏•‡∏±‡∏Å‡∏©‡∏ì‡πå... (‡πÄ‡∏ä‡πà‡∏ô integral, log, sin, ‡πÄ‡∏ã‡∏ï)" class="w-full pl-10 pr-4 py-2.5 border border-stone-200 rounded-xl text-sm focus:ring-2 focus:ring-amber-300 focus:border-amber-400 outline-none transition-all shadow-sm">
                    <span class="absolute left-3.5 top-2.5 text-stone-400">üîç</span>
                </div>
            </div>
        </section>

        <section>
            <div id="emptyState" class="hidden text-center py-20 bg-stone-50 rounded-2xl border border-dashed border-stone-300">
                <span class="text-6xl mb-4 inline-block grayscale opacity-50">üîç</span>
                <p class="text-stone-500 font-medium">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏™‡∏±‡∏ç‡∏•‡∏±‡∏Å‡∏©‡∏ì‡πå‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</p>
                <button onclick="searchInput.value=''; searchInput.dispatchEvent(new Event('input'))" class="mt-4 text-amber-600 text-xs font-bold hover:underline">‡∏•‡πâ‡∏≤‡∏á‡∏Ñ‡∏≥‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</button>
            </div>
            <div id="gridContainer" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4"></div>
        </section>

        <section class="bg-white border border-stone-200 p-6 rounded-2xl shadow-sm">
            <h2 class="text-base font-bold text-stone-800 mb-4 flex items-center gap-2">
                <span>üìä</span> ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏™‡∏±‡∏ç‡∏•‡∏±‡∏Å‡∏©‡∏ì‡πå‡∏ï‡∏≤‡∏°‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà
            </h2>
            <div class="chart-container">
                <canvas id="distributionChart"></canvas>
            </div>
        </section>
    </main>

    <div id="aiModal" class="hidden fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4 transition-opacity duration-300">
        <div id="aiModalContent" class="bg-white rounded-2xl max-w-3xl w-full max-h-[85vh] flex flex-col shadow-2xl transform scale-95 opacity-0 transition-all duration-300">
            
            <div class="bg-gradient-to-r from-amber-500 to-orange-500 p-6 text-white flex items-center justify-between rounded-t-2xl shrink-0">
                <div class="flex items-center gap-4">
                    <div class="w-12 h-12 bg-white/20 rounded-full flex items-center justify-center backdrop-blur-md">
                        <span id="modalSymbolIcon" class="text-2xl font-serif">‚àë</span>
                    </div>
                    <div>
                        <h3 id="modalTitle" class="text-xl font-bold">Summation</h3>
                        <p class="text-xs text-amber-100 mt-0.5 font-medium">AI Math Tutor Agent</p>
                    </div>
                </div>
                <button id="closeModal" class="w-8 h-8 flex items-center justify-center rounded-full bg-white/10 hover:bg-white/20 text-white transition-colors">‚úï</button>
            </div>

            <div class="p-6 overflow-y-auto custom-scrollbar flex-grow">
                <div class="grid grid-cols-2 sm:grid-cols-4 gap-3 mb-6">
                    <button onclick="askAI('explain')" class="flex flex-col items-center justify-center gap-1 p-3 bg-amber-50 hover:bg-amber-100 border border-amber-200 rounded-xl text-xs font-bold text-amber-700 transition-all hover:scale-105 active:scale-95">
                        <span class="text-lg">üìö</span> ‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢
                    </button>
                    <button onclick="askAI('example')" class="flex flex-col items-center justify-center gap-1 p-3 bg-blue-50 hover:bg-blue-100 border border-blue-200 rounded-xl text-xs font-bold text-blue-700 transition-all hover:scale-105 active:scale-95">
                        <span class="text-lg">üí°</span> ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á
                    </button>
                    <button onclick="askAI('problem')" class="flex flex-col items-center justify-center gap-1 p-3 bg-green-50 hover:bg-green-100 border border-green-200 rounded-xl text-xs font-bold text-green-700 transition-all hover:scale-105 active:scale-95">
                        <span class="text-lg">üéØ</span> ‡πÇ‡∏à‡∏ó‡∏¢‡πå
                    </button>
                    <button onclick="askAI('realworld')" class="flex flex-col items-center justify-center gap-1 p-3 bg-purple-50 hover:bg-purple-100 border border-purple-200 rounded-xl text-xs font-bold text-purple-700 transition-all hover:scale-105 active:scale-95">
                        <span class="text-lg">üåç</span> ‡πÉ‡∏ä‡πâ‡∏à‡∏£‡∏¥‡∏á
                    </button>
                </div>

                <div id="aiResponse" class="text-sm text-stone-700 leading-relaxed bg-stone-50 p-6 rounded-xl border border-stone-200 ai-content min-h-[200px]">
                    <div class="flex flex-col items-center justify-center h-full opacity-40 py-10">
                        <span class="text-4xl mb-2">üí¨</span>
                        <p class="text-xs">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏™‡∏ô‡∏ó‡∏ô‡∏≤‡∏Å‡∏±‡∏ö AI</p>
                    </div>
                </div>
            </div>
            
            <div class="p-4 border-t border-stone-100 text-center bg-stone-50 rounded-b-2xl shrink-0">
                <p class="text-[10px] text-stone-400">Powered by Google Gemini ‚Ä¢ ‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏≠‡∏≤‡∏à‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏•‡∏≤‡∏î‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô ‡πÇ‡∏õ‡∏£‡∏î‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á</p>
            </div>
        </div>
    </div>

    <footer class="bg-white border-t border-stone-200 py-6 mt-12">
        <div class="max-w-7xl mx-auto px-4 text-center">
            <p class="text-xs text-stone-500 font-medium">Math Explorer Pro ¬© 2024</p>
            <p class="text-[10px] text-stone-400 mt-1">Powered by Gemini AI ‚Ä¢ Database size: <span id="symbolCount">0</span> symbols</p>
        </div>
    </footer>

    <script>
        // ========================================
        // ‚öôÔ∏è CONFIGURATION & STATE
        // ========================================
        
        // API Key ‡∏à‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏£‡∏∞‡∏ö‡∏∏‡∏°‡∏≤
        const GEMINI_API_KEY = 'AIzaSyBiOq45ORuHn_9-09GbCbM79o7tncOkkY4'; 
        const MODEL_NAME = 'gemini-2.5-flash'; 

        let currentSymbolContext = null;
        let currentCategory = 'All';
        let searchQuery = '';
        let quizMode = false;
        let chartInstance = null;

        // ========================================
        // üìö DATA SOURCE
        // ========================================
        const symbolData = [
            { s: "‚àë", en: "Summation", th: "‡∏ú‡∏•‡∏£‡∏ß‡∏°", desc: "sigma", cat: "Special" },
            { s: "‚àè", en: "Product", th: "‡∏ú‡∏•‡∏Ñ‡∏π‡∏ì", desc: "pi", cat: "Special" },
            { s: "‚àû", en: "Infinity", th: "‡∏≠‡∏ô‡∏±‡∏ô‡∏ï‡πå", desc: "", cat: "Special" },
            { s: "‚àÄ", en: "For All", th: "‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ó‡∏∏‡∏Å", desc: "", cat: "Logic" },
            { s: "‚àÉ", en: "Exists", th: "‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà", desc: "", cat: "Logic" },
            { s: "‚àÑ", en: "Not Exists", th: "‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà", desc: "", cat: "Logic" },
            { s: "‚áí", en: "Implies", th: "‡∏ô‡∏±‡∏¢‡∏ß‡πà‡∏≤", desc: "", cat: "Logic" },
            { s: "‚áî", en: "Iff", th: "‡∏Å‡πá‡∏ï‡πà‡∏≠‡πÄ‡∏°‡∏∑‡πà‡∏≠", desc: "", cat: "Logic" },
            { s: "¬¨", en: "Not", th: "‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà", desc: "", cat: "Logic" },
            { s: "‚àß", en: "And", th: "‡πÅ‡∏•‡∏∞", desc: "", cat: "Logic" },
            { s: "‚à®", en: "Or", th: "‡∏´‡∏£‡∏∑‡∏≠", desc: "", cat: "Logic" },
            { s: "‚àà", en: "Element of", th: "‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å", desc: "", cat: "Set Theory" },
            { s: "‚àâ", en: "Not Element of", th: "‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å", desc: "", cat: "Set Theory" },
            { s: "‚äÜ", en: "Subset", th: "‡∏™‡∏±‡∏ö‡πÄ‡∏ã‡∏ï", desc: "", cat: "Set Theory" },
            { s: "‚äÇ", en: "Proper Subset", th: "‡∏™‡∏±‡∏ö‡πÄ‡∏ã‡∏ï‡πÅ‡∏ó‡πâ", desc: "", cat: "Set Theory" },
            { s: "‚à™", en: "Union", th: "‡∏¢‡∏π‡πÄ‡∏ô‡∏µ‡∏¢‡∏ô", desc: "", cat: "Set Theory" },
            { s: "‚à©", en: "Intersection", th: "‡∏≠‡∏¥‡∏ô‡πÄ‡∏ï‡∏≠‡∏£‡πå‡πÄ‡∏ã‡∏Å", desc: "", cat: "Set Theory" },
            { s: "‚àÖ", en: "Empty Set", th: "‡πÄ‡∏ã‡∏ï‡∏ß‡πà‡∏≤‡∏á", desc: "null", cat: "Set Theory" },
            { s: "‚Ñï", en: "Natural", th: "‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ô‡∏±‡∏ö", desc: "", cat: "Number Sets" },
            { s: "‚Ñ§", en: "Integer", th: "‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏ï‡πá‡∏°", desc: "", cat: "Number Sets" },
            { s: "‚Ñö", en: "Rational", th: "‡∏ï‡∏£‡∏£‡∏Å‡∏¢‡∏∞", desc: "", cat: "Number Sets" },
            { s: "‚Ñù", en: "Real", th: "‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏à‡∏£‡∏¥‡∏á", desc: "", cat: "Number Sets" },
            { s: "‚ÑÇ", en: "Complex", th: "‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏ä‡∏¥‡∏á‡∏ã‡πâ‡∏≠‡∏ô", desc: "", cat: "Number Sets" },
            { s: "‚âà", en: "Approx", th: "‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì", desc: "", cat: "Comparison" },
            { s: "‚â†", en: "Not Equal", th: "‡πÑ‡∏°‡πà‡πÄ‡∏ó‡πà‡∏≤", desc: "", cat: "Comparison" },
            { s: "‚â§", en: "Less Equal", th: "‡∏ô‡πâ‡∏≠‡∏¢‡∏Å‡∏ß‡πà‡∏≤‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏ó‡πà‡∏≤", desc: "", cat: "Comparison" },
            { s: "‚â•", en: "Greater Equal", th: "‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏ó‡πà‡∏≤", desc: "", cat: "Comparison" },
            { s: "‚â™", en: "Much Less", th: "‡∏ô‡πâ‡∏≠‡∏¢‡∏Å‡∏ß‡πà‡∏≤‡∏°‡∏≤‡∏Å", desc: "", cat: "Comparison" },
            { s: "‚â´", en: "Much Greater", th: "‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤‡∏°‡∏≤‡∏Å", desc: "", cat: "Comparison" },
            { s: "‚àù", en: "Proportional", th: "‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô", desc: "", cat: "Comparison" },
            { s: "‚àö", en: "Square Root", th: "‡∏£‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡∏™‡∏≠‡∏á", desc: "", cat: "Special" },
            { s: "‚àõ", en: "Cube Root", th: "‡∏£‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡∏™‡∏≤‡∏°", desc: "", cat: "Special" },
            { s: "œÄ", en: "Pi", th: "‡πÑ‡∏û", desc: "3.14159...", cat: "Special" },
            { s: "e", en: "Euler", th: "‡∏≠‡∏µ‡∏≠‡∏≠‡∏¢‡πÄ‡∏•‡∏≠‡∏£‡πå", desc: "2.718...", cat: "Special" },
            { s: "‚à´", en: "Integral", th: "‡∏≠‡∏¥‡∏ô‡∏ó‡∏¥‡∏Å‡∏£‡∏±‡∏•", desc: "", cat: "Calculus" },
            { s: "‚àÇ", en: "Partial", th: "‡∏î‡∏¥‡∏ü‡∏¢‡πà‡∏≠‡∏¢", desc: "", cat: "Calculus" },
            { s: "‚àÜ", en: "Delta", th: "‡πÄ‡∏î‡∏•‡∏ï‡∏≤", desc: "‡∏ú‡∏•‡∏ï‡πà‡∏≤‡∏á", cat: "Calculus" },
            { s: "‚àá", en: "Nabla", th: "‡∏ô‡∏≤‡∏ö‡∏•‡∏≤", desc: "‡πÄ‡∏Å‡∏£‡πÄ‡∏î‡∏µ‡∏¢‡∏ô‡∏ï‡πå", cat: "Calculus" },
            { s: "‚Üí", en: "Vector", th: "‡πÄ‡∏ß‡∏Å‡πÄ‡∏ï‡∏≠‡∏£‡πå", desc: "", cat: "Vectors" },
            { s: "‚Äñv‚Äñ", en: "Norm", th: "‡∏Ç‡∏ô‡∏≤‡∏î‡πÄ‡∏ß‡∏Å‡πÄ‡∏ï‡∏≠‡∏£‡πå", desc: "", cat: "Vectors" },
            { s: "det", en: "Determinant", th: "‡∏î‡∏µ‡πÄ‡∏ó‡∏≠‡∏£‡πå‡∏°‡∏¥‡πÅ‡∏ô‡∏ô‡∏ï‡πå", desc: "", cat: "Vectors" },
            { s: "T", en: "Transpose", th: "‡∏ó‡∏£‡∏≤‡∏ô‡∏™‡πÇ‡∏û‡∏™", desc: "", cat: "Vectors" },
            { s: "¬∑", en: "Dot Product", th: "‡∏î‡∏≠‡∏ó", desc: "", cat: "Vectors" },
            { s: "√ó", en: "Cross Product", th: "‡∏Ñ‡∏£‡∏≠‡∏™", desc: "", cat: "Vectors" },
            { s: "‚à†", en: "Angle", th: "‡∏°‡∏∏‡∏°", desc: "", cat: "Geometry" },
            { s: "‚ñ≥", en: "Triangle", th: "‡∏™‡∏≤‡∏°‡πÄ‡∏´‡∏•‡∏µ‡πà‡∏¢‡∏°", desc: "", cat: "Geometry" },
            { s: "‚à•", en: "Parallel", th: "‡∏Ç‡∏ô‡∏≤‡∏ô", desc: "", cat: "Geometry" },
            { s: "‚ä•", en: "Perpendicular", th: "‡∏ï‡∏±‡πâ‡∏á‡∏â‡∏≤‡∏Å", desc: "", cat: "Geometry" },
            { s: "¬∞", en: "Degree", th: "‡∏≠‡∏á‡∏®‡∏≤", desc: "", cat: "Geometry" },
            { s: "‚âÖ", en: "Congruent", th: "‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏±‡∏ô‡∏ó‡∏∏‡∏Å‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏£", desc: "", cat: "Geometry" },
            { s: "‚à£", en: "Divides", th: "‡∏´‡∏≤‡∏£‡∏•‡∏á‡∏ï‡∏±‡∏ß", desc: "", cat: "Number Theory" },
            { s: "‚à§", en: "No divide", th: "‡πÑ‡∏°‡πà‡∏•‡∏á‡∏ï‡∏±‡∏ß", desc: "", cat: "Number Theory" },
            { s: "‚â°", en: "Congruence", th: "‡∏™‡∏°‡∏†‡∏≤‡∏Ñ", desc: "mod", cat: "Number Theory" },
            { s: "gcd", en: "GCD", th: "‡∏´.‡∏£.‡∏°.", desc: "", cat: "Number Theory" },
            { s: "lcm", en: "LCM", th: "‡∏Ñ.‡∏£.‡∏ô.", desc: "", cat: "Number Theory" },
            { s: "f(x)", en: "Function", th: "‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô", desc: "", cat: "Functions" },
            { s: "log", en: "Log", th: "‡∏•‡∏≠‡∏Å‡∏≤‡∏£‡∏¥‡∏ó‡∏∂‡∏°", desc: "", cat: "Functions" },
            { s: "ln", en: "Natural Log", th: "ln", desc: "", cat: "Functions" },
            { s: "sin", en: "Sine", th: "‡πÑ‡∏ã‡∏ô‡πå", desc: "", cat: "Functions" },
            { s: "‚ä¢", en: "Turnstile", th: "‡∏û‡∏¥‡∏™‡∏π‡∏à‡∏ô‡πå‡πÑ‡∏î‡πâ", desc: "", cat: "Adv Logic" },
            { s: "‚ä®", en: "Double Turnstile", th: "‡∏™‡∏°‡πÄ‡∏´‡∏ï‡∏∏‡∏™‡∏°‡∏ú‡∏•", desc: "", cat: "Adv Logic" }
        ];

        const categories = ['All', ...new Set(symbolData.map(d => d.cat))];

        // ========================================
        // ü§ñ GEMINI API LOGIC
        // ========================================
        
        async function callGeminiAPI(prompt) {
            if (!GEMINI_API_KEY || GEMINI_API_KEY.includes('YOUR_API_KEY')) {
                return '‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏û‡∏ö API Key: ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£ GEMINI_API_KEY ‡πÉ‡∏ô‡πÇ‡∏Ñ‡πâ‡∏î';
            }

            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1/models/${MODEL_NAME}:generateContent?key=${GEMINI_API_KEY}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: prompt }] }],
                        generationConfig: {
                            temperature: 0.7,
                            maxOutputTokens: 1000,
                        }
                    })
                });

                if (!response.ok) {
                    const errorDetails = await response.json();
                    throw new Error(errorDetails.error?.message || response.statusText);
                }

                const data = await response.json();
                const text = data.candidates?.[0]?.content?.parts?.[0]?.text;
                return text || "ü§î AI ‡πÑ‡∏°‡πà‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö (‡∏≠‡∏≤‡∏à‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•)";
            } catch (error) {
                console.error('Gemini API Error:', error);
                return `‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠: ${error.message}`;
            }
        }

        async function askAI(mode) {
            if (!currentSymbolContext) return;
            
            const item = currentSymbolContext;
            const modes = {
                'explain': `‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏™‡∏±‡∏ç‡∏•‡∏±‡∏Å‡∏©‡∏ì‡πå‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå "${item.s}" (${item.en} / ${item.th}) ‡πÅ‡∏ö‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏á‡πà‡∏≤‡∏¢‡πÜ ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏™‡∏≠‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ó‡∏µ‡πà‡∏°‡∏≤‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏°‡∏≤‡∏¢`,
                'example': `‡πÅ‡∏™‡∏î‡∏á‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÇ‡∏à‡∏ó‡∏¢‡πå‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏™‡∏±‡∏ç‡∏•‡∏±‡∏Å‡∏©‡∏ì‡πå "${item.s}" (${item.en}) ‡∏°‡∏≤ 2 ‡∏Ç‡πâ‡∏≠ ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏≥‡πÅ‡∏•‡∏∞‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏ó‡∏µ‡πà‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô`,
                'problem': `‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏à‡∏ó‡∏¢‡πå‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ó‡πâ‡∏≤‡∏ó‡∏≤‡∏¢ (Challenge) ‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö "${item.s}" (${item.en}) 1 ‡∏Ç‡πâ‡∏≠ ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÄ‡∏â‡∏•‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î`,
                'realworld': `‡∏¢‡∏Å‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏¢‡∏∏‡∏Å‡∏ï‡πå‡πÉ‡∏ä‡πâ "${item.s}" (${item.en}) ‡πÉ‡∏ô‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï‡∏à‡∏£‡∏¥‡∏á ‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏ô‡∏á‡∏≤‡∏ô‡∏ß‡∏¥‡∏®‡∏ß‡∏Å‡∏£‡∏£‡∏°/‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå`
            };

            const prompt = modes[mode] || modes['explain'];
            const responseDiv = document.getElementById('aiResponse');
            
            responseDiv.innerHTML = `
                <div class="flex flex-col items-center justify-center py-8">
                    <div class="text-3xl animate-bounce mb-2">ü§î</div>
                    <p class="text-stone-500 text-xs font-bold loading-dots">AI ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏£‡∏ß‡∏ö‡∏£‡∏ß‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</p>
                </div>
            `;
            
            const result = await callGeminiAPI(prompt);
            responseDiv.innerHTML = formatAIResponse(result);
            
            // ‡∏™‡∏±‡πà‡∏á‡πÉ‡∏´‡πâ MathJax ‡πÅ‡∏õ‡∏•‡∏á‡∏™‡∏°‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡∏°‡πà‡πÉ‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏¥‡πà‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ
            if (window.MathJax) {
                MathJax.typesetPromise([responseDiv]).catch((err) => console.log('MathJax Error:', err));
            }
        }

        async function generateRoadmap() {
            const roadmapSection = document.getElementById('roadmapSection');
            const roadmapResult = document.getElementById('roadmapResult');
            const catDisplay = currentCategory === 'All' ? '‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô' : currentCategory;
            
            document.getElementById('roadmapCategoryName').textContent = catDisplay;
            roadmapSection.classList.remove('hidden');
            
            roadmapResult.innerHTML = `
                <div class="flex flex-col items-center justify-center py-10">
                    <div class="w-10 h-10 border-4 border-amber-500 border-t-transparent rounded-full animate-spin mb-4"></div>
                    <p class="text-stone-400 text-xs loading-dots">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•</p>
                </div>
            `;
            
            const prompt = `‡∏™‡∏£‡πâ‡∏≤‡∏á Learning Roadmap ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠ "${catDisplay}" ‡πÉ‡∏ô‡∏ß‡∏¥‡∏ä‡∏≤‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏°‡∏±‡∏ò‡∏¢‡∏°‡∏õ‡∏•‡∏≤‡∏¢
            ‡∏Ç‡∏≠‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö:
            1. ‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô (Step-by-step)
            2. ‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏ô‡πâ‡∏ô
            3. ‡πÄ‡∏Ñ‡∏•‡πá‡∏î‡∏•‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏à‡∏≥
            ‡∏ï‡∏≠‡∏ö‡∏î‡πâ‡∏ß‡∏¢‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢ ‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡πâ‡∏≠‡πÜ ‡∏≠‡πà‡∏≤‡∏ô‡∏á‡πà‡∏≤‡∏¢`;
            
            const result = await callGeminiAPI(prompt);
            roadmapResult.innerHTML = formatAIResponse(result);
             if (window.MathJax) {
                MathJax.typesetPromise([roadmapResult]).catch((err) => console.log('MathJax Error:', err));
            }
        }

        function formatAIResponse(text) {
            // ‡πÉ‡∏ä‡πâ marked.js ‡πÅ‡∏õ‡∏•‡∏á Markdown ‚Üí HTML (‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö nested lists, bold, code, ‡∏Ø‡∏•‡∏Ø)
            marked.setOptions({ breaks: true, gfm: true, headerIds: false, mangle: false });
            const html = marked.parse(text);
            return '<div class="ai-rendered-content text-sm leading-relaxed">' + html + '</div>';
        }

        // ========================================
        // üéÆ UI INTERACTION
        // ========================================

        function renderCategories() {
            const container = document.getElementById('categoryContainer');
            const thaiNames = { 
                'All': '‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î', 'Number Sets': '‡πÄ‡∏ã‡∏ï‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç', 'Set Theory': '‡πÄ‡∏ã‡∏ï', 'Logic': '‡∏ï‡∏£‡∏£‡∏Å‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå', 
                'Comparison': '‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö', 'Special': '‡∏û‡∏¥‡πÄ‡∏®‡∏©', 'Calculus': '‡πÅ‡∏Ñ‡∏•‡∏Ñ‡∏π‡∏•‡∏±‡∏™', 'Vectors': '‡πÄ‡∏ß‡∏Å‡πÄ‡∏ï‡∏≠‡∏£‡πå', 
                'Geometry': '‡πÄ‡∏£‡∏Ç‡∏≤‡∏Ñ‡∏ì‡∏¥‡∏ï', 'Number Theory': '‡∏ó‡∏§‡∏©‡∏é‡∏µ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô', 'Functions': '‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô', 'Adv Logic': '‡∏Ç‡∏±‡πâ‡∏ô‡∏™‡∏π‡∏á' 
            };

            container.innerHTML = categories.map(cat => {
                const isActive = currentCategory === cat;
                const baseClass = "px-3 py-1.5 rounded-lg text-xs font-bold whitespace-nowrap transition-all border";
                const activeClass = isActive 
                    ? "bg-amber-500 text-white border-amber-600 shadow-md transform scale-105" 
                    : "bg-white text-stone-600 border-stone-200 hover:bg-stone-50 hover:border-amber-300";
                
                return `<button onclick="setCategory('${cat}')" class="${baseClass} ${activeClass}">${thaiNames[cat] || cat}</button>`;
            }).join('');
        }

        function renderGrid() {
            const container = document.getElementById('gridContainer');
            const emptyState = document.getElementById('emptyState');
            
            container.innerHTML = '';
            
            const filtered = symbolData.filter(item => {
                const matchesCat = currentCategory === 'All' || item.cat === currentCategory;
                const query = searchQuery.toLowerCase();
                return matchesCat && (
                    item.s.toLowerCase().includes(query) || 
                    item.en.toLowerCase().includes(query) || 
                    item.th.toLowerCase().includes(query)
                );
            });
            
            if (filtered.length === 0) {
                emptyState.classList.remove('hidden');
            } else {
                emptyState.classList.add('hidden');
                filtered.forEach((item, index) => {
                    const card = document.createElement('div');
                    card.className = `symbol-card bg-white p-5 rounded-2xl border border-stone-100 flex flex-col items-center text-center group h-full justify-between relative overflow-hidden`;
                    card.innerHTML = `
                        <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-amber-300 to-orange-300 opacity-0 group-hover:opacity-100 transition-opacity"></div>
                        <div class="mb-4 h-14 flex items-center justify-center w-full">
                            <span class="text-4xl font-serif text-stone-800 transform group-hover:scale-110 transition-transform">${item.s}</span>
                        </div>
                        <div class="w-full space-y-1 mb-4 flex-grow flex flex-col justify-center">
                            <h3 class="text-sm font-bold text-amber-700 name-en">${item.en}</h3>
                            <p class="text-stone-500 font-medium text-xs meaning">${item.th}</p>
                        </div>
                        <button onclick="openAiModal(${index})" class="w-full py-2 bg-stone-50 hover:bg-amber-500 hover:text-white text-stone-600 text-[10px] font-bold rounded-lg transition-all border border-stone-200 hover:border-amber-500 flex items-center justify-center gap-1 group-btn">
                            <span class="opacity-50 group-hover:opacity-100">‚ú®</span> ‡∏ñ‡∏≤‡∏° AI
                        </button>
                    `;
                    container.appendChild(card);
                });
            }
            
            document.getElementById('symbolCount').textContent = symbolData.length;
        }

        function setCategory(cat) { currentCategory = cat; renderCategories(); renderGrid(); }

        // ========================================
        // üñºÔ∏è MODAL LOGIC
        // ========================================
        
        const modal = document.getElementById('aiModal');
        const modalContent = document.getElementById('aiModalContent');

        function openAiModal(index) {
            // Find actual item from current filtered list logic (to match index)
            const filtered = symbolData.filter(item => {
                const matchesCat = currentCategory === 'All' || item.cat === currentCategory;
                const query = searchQuery.toLowerCase();
                return matchesCat && (item.s.toLowerCase().includes(query) || item.en.toLowerCase().includes(query) || item.th.toLowerCase().includes(query));
            });
            
            const item = filtered[index];
            currentSymbolContext = item;
            
            document.getElementById('modalTitle').textContent = `${item.en} (${item.th})`;
            document.getElementById('modalSymbolIcon').textContent = item.s;
            document.getElementById('aiResponse').innerHTML = `
                <div class="flex flex-col items-center justify-center h-full opacity-40 py-10">
                    <span class="text-4xl mb-2">üí¨</span>
                    <p class="text-xs">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏™‡∏ô‡∏ó‡∏ô‡∏≤‡∏Å‡∏±‡∏ö AI</p>
                </div>
            `;
            
            modal.classList.remove('hidden');
            // Small delay to allow display:block to apply before opacity transition
            setTimeout(() => {
                modal.classList.remove('opacity-0');
                modalContent.classList.remove('scale-95', 'opacity-0');
                modalContent.classList.add('scale-100', 'opacity-100');
            }, 10);
        }

        function closeModal() {
            modalContent.classList.remove('scale-100', 'opacity-100');
            modalContent.classList.add('scale-95', 'opacity-0');
            modal.classList.add('opacity-0');
            setTimeout(() => { modal.classList.add('hidden'); }, 300);
            currentSymbolContext = null;
        }

        function closeRoadmap() {
            document.getElementById('roadmapSection').classList.add('hidden');
        }

        // ========================================
        // üìä LAZY LOAD CHART
        // ========================================

        function loadChart() {
            // ‡πÇ‡∏´‡∏•‡∏î Library Chart.js ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
            if (typeof Chart === 'undefined') {
                const script = document.createElement('script');
                script.src = 'https://cdn.jsdelivr.net/npm/chart.js';
                script.onload = initChart;
                document.head.appendChild(script);
            } else {
                initChart();
            }
        }

        function initChart() {
            if (chartInstance) return; // Prevent duplicate
            
            const ctx = document.getElementById('distributionChart').getContext('2d');
            const counts = {};
            symbolData.forEach(item => { counts[item.cat] = (counts[item.cat] || 0) + 1; });
            
            const labels = categories.filter(c => c !== 'All');
            const data = labels.map(cat => counts[cat] || 0);
            
            chartInstance = new Chart(ctx, {
                type: 'bar',
                data: { 
                    labels: labels, 
                    datasets: [{ 
                        label: '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏™‡∏±‡∏ç‡∏•‡∏±‡∏Å‡∏©‡∏ì‡πå', 
                        data: data, 
                        backgroundColor: '#f59e0b',
                        borderRadius: 6,
                        hoverBackgroundColor: '#d97706'
                    }] 
                },
                options: { 
                    responsive: true, 
                    maintainAspectRatio: false, 
                    plugins: { legend: { display: false } }, 
                    scales: { 
                        y: { beginAtZero: true, grid: { color: '#f5f5f4' } }, 
                        x: { grid: { display: false }, ticks: { font: { size: 10 } } } 
                    },
                    animation: { duration: 1500, easing: 'easeOutQuart' }
                }
            });
        }

        // ‡πÉ‡∏ä‡πâ IntersectionObserver ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÇ‡∏´‡∏•‡∏î‡∏Å‡∏£‡∏≤‡∏ü‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏•‡∏á‡∏°‡∏≤‡πÄ‡∏à‡∏≠
        const observer = new IntersectionObserver((entries) => {
            if(entries[0].isIntersecting) {
                loadChart();
                observer.disconnect();
            }
        });
        observer.observe(document.querySelector('.chart-container'));

        // ========================================
        // üöÄ EVENTS
        // ========================================

        document.getElementById('searchInput').addEventListener('input', (e) => { 
            searchQuery = e.target.value; 
            renderGrid(); 
        });

        document.getElementById('quizToggle').addEventListener('click', () => {
            quizMode = !quizMode;
            const btn = document.getElementById('quizToggle');
            const icon = document.getElementById('quizIcon');
            const txt = document.getElementById('quizText');
            
            if (quizMode) { 
                document.body.classList.add('quiz-mode'); 
                btn.classList.add('bg-amber-500', 'text-white', 'border-amber-600');
                btn.classList.remove('bg-stone-100', 'text-stone-600', 'border-stone-200');
                icon.textContent = 'üôà';
                txt.textContent = "‡∏õ‡∏¥‡∏î‡πÇ‡∏´‡∏°‡∏î‡∏ó‡πà‡∏≠‡∏á‡∏à‡∏≥"; 
            } else { 
                document.body.classList.remove('quiz-mode'); 
                btn.classList.remove('bg-amber-500', 'text-white', 'border-amber-600');
                btn.classList.add('bg-stone-100', 'text-stone-600', 'border-stone-200');
                icon.textContent = 'üëÅÔ∏è';
                txt.textContent = "‡πÇ‡∏´‡∏°‡∏î‡∏ó‡πà‡∏≠‡∏á‡∏à‡∏≥ (Quiz Mode)"; 
            }
        });

        document.getElementById('closeModal').addEventListener('click', closeModal);
        // Close modal on click outside
        modal.addEventListener('click', (e) => { if(e.target === modal) closeModal(); });

        // Init
        renderCategories();
        renderGrid();

    </script>
</body>
</html>