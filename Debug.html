<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MTC the Game ‚Äî System Diagnostics v3.6.2</title>

    <!--
    ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
    ‚ïë       MTC the Game Beta Edition ‚Äî DEBUG.HTML v3.6.2          ‚ïë
    ‚ïë‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ïë
    ‚ïë  ‡∏ß‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå‡∏ô‡∏µ‡πâ‡πÉ‡∏ô project ROOT ‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ô browser ‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢       ‚ïë
    ‚ïë  Scripts ‡πÇ‡∏´‡∏•‡∏î‡πÉ‡∏ô‡∏•‡∏≥‡∏î‡∏±‡∏ö‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ö index.html                     ‚ïë
    ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
    -->

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&family=Orbitron:wght@400;700;900&display=swap"
        rel="stylesheet">

    <style>
        :root {
            --bg-dark: #030712;
            --bg-panel: #0a0f1e;
            --bg-card: #0d1526;
            --border: #1a2744;
            --border-glow: #1e3a6e;
            --text: #8da9c4;
            --text-bright: #c8ddf4;
            --primary: #2563eb;
            --primary-glow: rgba(37, 99, 235, 0.3);
            --success: #10b981;
            --success-bg: rgba(16, 185, 129, 0.1);
            --danger: #ef4444;
            --danger-bg: rgba(239, 68, 68, 0.1);
            --warning: #f59e0b;
            --warning-bg: rgba(245, 158, 11, 0.1);
            --accent: #06b6d4;
            --accent2: #7c3aed;
            --font-mono: 'Share Tech Mono', 'Courier New', monospace;
            --font-display: 'Orbitron', sans-serif;
        }

        *,
        *::before,
        *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            background: var(--bg-dark);
            color: var(--text);
            font-family: var(--font-mono);
            font-size: 13px;
            line-height: 1.6;
            min-height: 100vh;
            overflow-x: hidden;
        }

        body::before {
            content: '';
            position: fixed;
            inset: 0;
            background: repeating-linear-gradient(0deg, transparent, transparent 2px, rgba(0, 0, 0, 0.07) 2px, rgba(0, 0, 0, 0.07) 4px);
            pointer-events: none;
            z-index: 9999;
        }

        .corner {
            position: absolute;
            width: 16px;
            height: 16px;
        }

        .corner-tl {
            top: 0;
            left: 0;
            border-top: 2px solid var(--accent);
            border-left: 2px solid var(--accent);
        }

        .corner-tr {
            top: 0;
            right: 0;
            border-top: 2px solid var(--accent);
            border-right: 2px solid var(--accent);
        }

        .corner-bl {
            bottom: 0;
            left: 0;
            border-bottom: 2px solid var(--accent);
            border-left: 2px solid var(--accent);
        }

        .corner-br {
            bottom: 0;
            right: 0;
            border-bottom: 2px solid var(--accent);
            border-right: 2px solid var(--accent);
        }

        #app {
            max-width: 1500px;
            margin: 0 auto;
            padding: 20px;
        }

        /* ‚îÄ‚îÄ Header ‚îÄ‚îÄ */
        .header {
            position: relative;
            padding: 30px 0 24px;
            margin-bottom: 24px;
            border-bottom: 1px solid var(--border);
        }

        .header::after {
            content: '';
            position: absolute;
            bottom: -1px;
            left: 0;
            width: 200px;
            height: 2px;
            background: linear-gradient(90deg, var(--accent), transparent);
        }

        .header-top {
            display: flex;
            align-items: flex-start;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 16px;
        }

        .title-eyebrow {
            font-size: 10px;
            letter-spacing: 4px;
            color: var(--accent);
            text-transform: uppercase;
            margin-bottom: 6px;
        }

        .title-main {
            font-family: var(--font-display);
            font-size: clamp(18px, 3vw, 30px);
            font-weight: 900;
            color: var(--text-bright);
            letter-spacing: 2px;
            text-transform: uppercase;
            line-height: 1;
        }

        .title-main span {
            color: var(--accent);
        }

        .title-sub {
            font-size: 11px;
            color: var(--text);
            margin-top: 8px;
            letter-spacing: 1px;
        }

        /* ‚îÄ‚îÄ Buttons ‚îÄ‚îÄ */
        .btn-group {
            display: flex;
            gap: 8px;
            align-items: center;
            flex-wrap: wrap;
        }

        .btn {
            font-family: var(--font-display);
            font-size: 10px;
            font-weight: 700;
            letter-spacing: 2px;
            text-transform: uppercase;
            padding: 10px 18px;
            border-radius: 3px;
            border: 1px solid transparent;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
            overflow: hidden;
        }

        .btn::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.08), transparent);
            transition: left 0.4s;
        }

        .btn:hover::after {
            left: 100%;
        }

        .btn-primary {
            background: var(--primary);
            border-color: #1d4ed8;
            color: white;
        }

        .btn-primary:hover {
            background: #1d4ed8;
            box-shadow: 0 0 20px var(--primary-glow);
        }

        .btn-run {
            background: transparent;
            border-color: var(--success);
            color: var(--success);
        }

        .btn-run:hover {
            background: var(--success-bg);
            box-shadow: 0 0 16px rgba(16, 185, 129, 0.25);
        }

        .btn-run:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }

        .btn-run:disabled:hover {
            background: transparent;
            box-shadow: none;
        }

        .btn-clear {
            background: transparent;
            border-color: var(--border-glow);
            color: var(--text);
        }

        .btn-clear:hover {
            border-color: var(--text);
            color: var(--text-bright);
        }

        .btn-copy {
            background: transparent;
            border-color: #7c3aed;
            color: #a78bfa;
        }

        .btn-copy:hover {
            background: rgba(124, 58, 237, 0.1);
            box-shadow: 0 0 16px rgba(124, 58, 237, 0.25);
        }

        .btn-copy.copied {
            border-color: var(--success);
            color: var(--success);
        }

        .btn-export {
            background: transparent;
            border-color: var(--warning);
            color: var(--warning);
        }

        .btn-export:hover {
            background: var(--warning-bg);
        }

        .live-clock {
            font-family: var(--font-display);
            font-size: 11px;
            color: var(--accent);
            letter-spacing: 2px;
            padding: 8px 14px;
            border: 1px solid var(--border);
            border-radius: 3px;
            background: var(--bg-card);
        }

        /* ‚îÄ‚îÄ Status Bar ‚îÄ‚îÄ */
        .status-bar {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 16px;
            margin-bottom: 20px;
            background: var(--bg-panel);
            border: 1px solid var(--border);
            border-radius: 4px;
            font-size: 12px;
            color: var(--text);
        }

        .status-bar-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--success);
            box-shadow: 0 0 8px var(--success);
            flex-shrink: 0;
        }

        .status-bar-dot.inactive {
            background: #334155;
            box-shadow: none;
        }

        @keyframes blink {

            0%,
            100% {
                opacity: 1
            }

            50% {
                opacity: 0
            }
        }

        .blink {
            animation: blink 1.1s step-end infinite;
            color: var(--accent);
        }

        /* ‚îÄ‚îÄ Progress ‚îÄ‚îÄ */
        .progress-bar-wrap {
            margin-bottom: 24px;
            padding: 16px 20px;
            background: var(--bg-panel);
            border: 1px solid var(--border);
            border-radius: 6px;
            position: relative;
        }

        .progress-bar-wrap .corner {
            position: absolute;
        }

        .progress-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .progress-label {
            font-family: var(--font-display);
            font-size: 10px;
            letter-spacing: 2px;
            text-transform: uppercase;
            color: var(--text);
        }

        .progress-stats {
            display: flex;
            gap: 20px;
            font-size: 11px;
        }

        .stat-pass {
            color: var(--success);
        }

        .stat-fail {
            color: var(--danger);
        }

        .stat-warn {
            color: var(--warning);
        }

        .stat-total {
            color: var(--text-bright);
        }

        .progress-track {
            height: 6px;
            background: var(--border);
            border-radius: 3px;
            overflow: hidden;
            position: relative;
        }

        .progress-fill {
            height: 100%;
            width: 0%;
            border-radius: 3px;
            background: linear-gradient(90deg, var(--primary), var(--accent));
            transition: width 0.5s ease;
        }

        @keyframes shimmer {
            0% {
                opacity: 0
            }

            50% {
                opacity: 1
            }

            100% {
                opacity: 0
            }
        }

        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 40px;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.5));
            animation: shimmer 1.5s infinite;
        }

        .progress-pct {
            font-family: var(--font-display);
            font-size: 11px;
            color: var(--accent);
            font-weight: 700;
            letter-spacing: 1px;
        }

        /* ‚îÄ‚îÄ NEW: Quick Stats Bar ‚îÄ‚îÄ */
        .quick-stats {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
            gap: 12px;
            margin-bottom: 24px;
        }

        .qs-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 6px;
            padding: 14px 16px;
            transition: border-color 0.2s;
        }

        .qs-card:hover {
            border-color: var(--border-glow);
        }

        .qs-label {
            font-size: 9px;
            letter-spacing: 2px;
            text-transform: uppercase;
            color: #475569;
            margin-bottom: 6px;
        }

        .qs-value {
            font-family: var(--font-display);
            font-size: 18px;
            font-weight: 700;
            color: var(--text-bright);
        }

        .qs-value.ok {
            color: var(--success);
        }

        .qs-value.err {
            color: var(--danger);
        }

        .qs-value.warn {
            color: var(--warning);
        }

        .qs-sub {
            font-size: 10px;
            color: #475569;
            margin-top: 2px;
        }

        /* ‚îÄ‚îÄ Sections Grid ‚îÄ‚îÄ */
        .sections-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(400px, 1fr));
            gap: 18px;
            margin-bottom: 24px;
        }

        .section-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 6px;
            overflow: hidden;
            transition: border-color 0.3s;
        }

        .section-card:hover {
            border-color: var(--border-glow);
        }

        .section-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 14px 18px;
            background: var(--bg-panel);
            border-bottom: 1px solid var(--border);
            cursor: pointer;
            user-select: none;
            transition: background 0.2s;
        }

        .section-header:hover {
            background: #0f1a2e;
        }

        .section-title-wrap {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section-icon {
            width: 28px;
            height: 28px;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            flex-shrink: 0;
        }

        .section-title {
            font-family: var(--font-display);
            font-size: 10px;
            letter-spacing: 2px;
            text-transform: uppercase;
            color: var(--text-bright);
            font-weight: 700;
        }

        .section-meta {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .mini-badge {
            font-size: 10px;
            padding: 2px 8px;
            border-radius: 10px;
            font-weight: bold;
            letter-spacing: 1px;
        }

        .mini-badge.pass {
            background: var(--success-bg);
            color: var(--success);
            border: 1px solid rgba(16, 185, 129, 0.3);
        }

        .mini-badge.fail {
            background: var(--danger-bg);
            color: var(--danger);
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        .mini-badge.warn {
            background: var(--warning-bg);
            color: var(--warning);
            border: 1px solid rgba(245, 158, 11, 0.3);
        }

        .mini-badge.idle {
            background: #1e293b;
            color: #64748b;
            border: 1px solid var(--border);
        }

        .collapse-arrow {
            color: var(--text);
            font-size: 12px;
            transition: transform 0.3s;
            line-height: 1;
        }

        .section-card.collapsed .collapse-arrow {
            transform: rotate(-90deg);
        }

        .section-body {
            padding: 0;
            overflow: hidden;
            transition: max-height 0.35s ease;
            max-height: 2000px;
        }

        .section-card.collapsed .section-body {
            max-height: 0;
        }

        /* ‚îÄ‚îÄ Test Item ‚îÄ‚îÄ */
        .test-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 9px 18px;
            border-bottom: 1px solid rgba(26, 39, 68, 0.6);
            gap: 12px;
            transition: background 0.15s;
            cursor: default;
        }

        .test-item:last-child {
            border-bottom: none;
        }

        .test-item:hover {
            background: rgba(255, 255, 255, 0.02);
        }

        .test-left {
            display: flex;
            align-items: center;
            gap: 10px;
            min-width: 0;
        }

        .test-indicator {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            flex-shrink: 0;
        }

        .test-indicator.pass {
            background: var(--success);
            box-shadow: 0 0 6px var(--success);
        }

        .test-indicator.fail {
            background: var(--danger);
            box-shadow: 0 0 6px var(--danger);
        }

        .test-indicator.warn {
            background: var(--warning);
            box-shadow: 0 0 6px var(--warning);
        }

        .test-indicator.idle {
            background: #334155;
        }

        @keyframes pulse {

            0%,
            100% {
                opacity: 1;
                transform: scale(1)
            }

            50% {
                opacity: 0.4;
                transform: scale(0.6)
            }
        }

        .test-indicator.running {
            background: var(--accent);
            animation: pulse 0.8s infinite;
        }

        .test-name {
            color: var(--text);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            font-size: 12px;
        }

        .test-right {
            display: flex;
            align-items: center;
            gap: 8px;
            flex-shrink: 0;
        }

        .status-badge {
            font-family: var(--font-display);
            font-size: 9px;
            font-weight: 700;
            letter-spacing: 1.5px;
            padding: 3px 10px;
            border-radius: 2px;
            text-transform: uppercase;
        }

        .status-badge.pass {
            background: var(--success-bg);
            color: var(--success);
            border: 1px solid rgba(16, 185, 129, 0.4);
        }

        .status-badge.fail {
            background: var(--danger-bg);
            color: var(--danger);
            border: 1px solid rgba(239, 68, 68, 0.4);
        }

        .status-badge.warn {
            background: var(--warning-bg);
            color: var(--warning);
            border: 1px solid rgba(245, 158, 11, 0.4);
        }

        .status-badge.idle {
            background: #1e293b;
            color: #475569;
            border: 1px solid var(--border);
        }

        .status-badge.running {
            background: rgba(6, 182, 212, 0.1);
            color: var(--accent);
            border: 1px solid rgba(6, 182, 212, 0.3);
        }

        .test-item[data-tip]:hover::after {
            content: attr(data-tip);
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: #0f172a;
            border: 1px solid var(--border-glow);
            color: var(--text-bright);
            padding: 6px 14px;
            border-radius: 4px;
            font-size: 11px;
            white-space: nowrap;
            z-index: 1000;
            pointer-events: none;
            max-width: 500px;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .ic-engine {
            background: rgba(37, 99, 235, 0.15);
            color: #60a5fa;
        }

        .ic-system {
            background: rgba(6, 182, 212, 0.15);
            color: var(--accent);
        }

        .ic-entity {
            background: rgba(124, 58, 237, 0.15);
            color: #a78bfa;
        }

        .ic-content {
            background: rgba(245, 158, 11, 0.15);
            color: var(--warning);
        }

        .ic-api {
            background: rgba(239, 68, 68, 0.15);
            color: #f87171;
        }

        .ic-achieve {
            background: rgba(16, 185, 129, 0.15);
            color: var(--success);
        }

        .ic-version {
            background: rgba(6, 182, 212, 0.15);
            color: var(--accent);
        }

        /* ‚îÄ‚îÄ Console ‚îÄ‚îÄ */
        .console-wrap {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 6px;
            overflow: hidden;
            margin-bottom: 20px;
        }

        .console-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px 18px;
            background: var(--bg-panel);
            border-bottom: 1px solid var(--border);
        }

        .console-title {
            font-family: var(--font-display);
            font-size: 10px;
            letter-spacing: 2px;
            color: var(--text);
            text-transform: uppercase;
        }

        .console-actions {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .console-dots {
            display: flex;
            gap: 6px;
        }

        .console-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
        }

        .dot-red {
            background: #ef4444;
        }

        .dot-yellow {
            background: #f59e0b;
        }

        .dot-green {
            background: #10b981;
        }

        #console-output {
            padding: 14px 18px;
            font-family: var(--font-mono);
            font-size: 12px;
            line-height: 1.7;
            max-height: 420px;
            overflow-y: auto;
            white-space: pre-wrap;
            word-break: break-all;
            scrollbar-width: thin;
            scrollbar-color: var(--border-glow) transparent;
        }

        #console-output::-webkit-scrollbar {
            width: 6px;
        }

        #console-output::-webkit-scrollbar-track {
            background: transparent;
        }

        #console-output::-webkit-scrollbar-thumb {
            background: var(--border-glow);
            border-radius: 3px;
        }

        .log-success {
            color: var(--success);
        }

        .log-error {
            color: var(--danger);
        }

        .log-warn {
            color: var(--warning);
        }

        .log-info {
            color: var(--accent);
        }

        .log-system {
            color: #475569;
        }

        .log-sep {
            color: #1e3a6e;
        }

        .log-prompt {
            color: var(--accent2);
            margin-right: 6px;
        }

        /* ‚îÄ‚îÄ NEW: Achievement Inspector ‚îÄ‚îÄ */
        .achieve-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 10px;
            padding: 14px 18px;
        }

        .achieve-item {
            background: var(--bg-panel);
            border: 1px solid var(--border);
            border-radius: 5px;
            padding: 10px 14px;
            font-size: 11px;
        }

        .achieve-item .a-icon {
            font-size: 18px;
            margin-bottom: 4px;
        }

        .achieve-item .a-id {
            color: #475569;
            font-size: 9px;
            letter-spacing: 1px;
        }

        .achieve-item .a-name {
            color: var(--text-bright);
            font-weight: bold;
            margin: 2px 0;
        }

        .achieve-item .a-desc {
            color: var(--text);
            font-size: 10px;
        }

        /* ‚îÄ‚îÄ NEW: BALANCE Inspector ‚îÄ‚îÄ */
        .balance-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 11px;
        }

        .balance-table th {
            text-align: left;
            padding: 8px 14px;
            color: #475569;
            font-size: 9px;
            letter-spacing: 2px;
            text-transform: uppercase;
            border-bottom: 1px solid var(--border);
        }

        .balance-table td {
            padding: 7px 14px;
            border-bottom: 1px solid rgba(26, 39, 68, 0.4);
            color: var(--text);
        }

        .balance-table tr:last-child td {
            border-bottom: none;
        }

        .balance-table tr:hover td {
            background: rgba(255, 255, 255, 0.02);
        }

        .balance-key {
            color: var(--accent);
            font-family: var(--font-mono);
        }

        .balance-value {
            color: var(--text-bright);
        }

        .balance-type {
            color: #475569;
            font-size: 9px;
        }

        /* ‚îÄ‚îÄ Inspector tabs ‚îÄ‚îÄ */
        .tab-bar {
            display: flex;
            gap: 0;
            border-bottom: 1px solid var(--border);
            background: var(--bg-panel);
        }

        .tab-btn {
            font-family: var(--font-display);
            font-size: 9px;
            letter-spacing: 2px;
            text-transform: uppercase;
            padding: 10px 16px;
            border: none;
            background: transparent;
            color: #475569;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            transition: all 0.2s;
        }

        .tab-btn:hover {
            color: var(--text);
        }

        .tab-btn.active {
            color: var(--accent);
            border-bottom-color: var(--accent);
        }

        .tab-panel {
            display: none;
        }

        .tab-panel.active {
            display: block;
        }

        .inspector-wrap {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 6px;
            overflow: hidden;
            margin-bottom: 24px;
        }

        .inspector-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px 18px;
            background: var(--bg-panel);
            border-bottom: 1px solid var(--border);
        }

        .inspector-title {
            font-family: var(--font-display);
            font-size: 10px;
            letter-spacing: 2px;
            color: var(--text);
            text-transform: uppercase;
        }

        /* ‚îÄ‚îÄ Copy toast ‚îÄ‚îÄ */
        #copy-toast {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%) translateY(60px);
            background: #0f172a;
            border: 1px solid var(--success);
            color: var(--success);
            padding: 8px 20px;
            border-radius: 4px;
            font-size: 12px;
            letter-spacing: 1px;
            transition: transform 0.25s ease, opacity 0.25s ease;
            opacity: 0;
            pointer-events: none;
            z-index: 10000;
        }

        #copy-toast.show {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
        }

        /* ‚îÄ‚îÄ Footer ‚îÄ‚îÄ */
        .footer {
            text-align: center;
            padding: 20px 0;
            font-size: 10px;
            color: #334155;
            letter-spacing: 2px;
            text-transform: uppercase;
            border-top: 1px solid var(--border);
            margin-top: 10px;
        }
    </style>
</head>

<body>

    <!-- ‚ïê‚ïê HIDDEN GAME DOM STUBS (‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô null reference errors ‡∏à‡∏≤‡∏Å game scripts) ‚ïê‚ïê -->
    <div id="__game_stub_wrapper__" style="display:none;visibility:hidden;position:absolute;left:-9999px;top:-9999px;"
        aria-hidden="true">
        <canvas id="gameCanvas" width="1" height="1"></canvas>
        <div id="ui-layer"></div>
        <div id="achievements"></div>
        <div id="player-level"></div>
        <div id="hp-bar" class="bar-fill"></div>
        <div id="en-bar" class="bar-fill"></div>
        <div id="exp-bar"></div>
        <div id="wave-badge"></div>
        <div id="score-display"></div>
        <div id="kills-display"></div>
        <div id="dash-cd"></div>
        <div id="dash-icon"></div>
        <div id="stealth-icon"></div>
        <div id="stealth-cd"></div>
        <div id="skill1-emoji"></div>
        <div id="skill1-hint"></div>
        <div id="passive-skill"></div>
        <div id="weapon-indicator"></div>
        <div id="weapon-name-text"></div>
        <div id="weapon-ammo"></div>
        <div id="shop-overlay"></div>
        <div id="shop-items"></div>
        <div id="db-prompt"></div>
        <div id="terminal-overlay"></div>
        <div id="terminal-output"></div>
        <div id="tutorial-overlay"></div>
        <div id="tutorial-card"></div>
        <div id="tut-icon"></div>
        <div id="tut-title"></div>
        <div id="tut-body"></div>
        <div id="tut-action-hint"></div>
        <div id="tut-action-bar">
            <div id="tut-action-fill"></div>
        </div>
        <div id="tut-action-label"></div>
        <div id="tutorial-progress"></div>
        <button id="tut-next-btn">NEXT</button>
        <button id="tut-skip-btn">SKIP</button>
        <div id="mobile-ui">
            <div id="joystick-left-zone" class="joystick-zone left">
                <div id="joystick-left-base" class="joystick-base">
                    <div id="joystick-left-stick" class="joystick-stick"></div>
                </div>
            </div>
            <div id="joystick-right-zone" class="joystick-zone right">
                <div id="joystick-right-base" class="joystick-base">
                    <div id="joystick-right-stick" class="joystick-stick"></div>
                </div>
            </div>
            <button id="btn-switch" class="action-btn">üîÑ</button>
            <button id="btn-skill" class="action-btn">üìñ</button>
            <button id="btn-dash" class="action-btn">üí®</button>
            <button id="btn-naga" class="action-btn">üêâ</button>
            <button id="btn-database" class="action-btn">üìö</button>
            <button id="btn-terminal" class="action-btn">üíª</button>
            <button id="btn-shop" class="action-btn">üõí</button>
        </div>
        <div id="card-kao" class="char-card selected" data-char="kao"></div>
        <div id="card-poom" class="char-card" data-char="poom"></div>
        <div id="btn-auto" class="char-card" data-char="auto"></div>
        <!-- Poom-specific -->
        <div id="ritual-cd"></div>
        <div id="naga-cd"></div>
        <!-- Kao-specific -->
        <div id="clone-cd"></div>
        <div id="teleport-cd"></div>
        <!-- Admin -->
        <div id="admin-console"></div>
        <div id="admin-output"></div>
        <input id="admin-input" type="text">
    </div>

    <!-- Real canvas for 2D context tests -->
    <canvas id="__real_canvas__" width="800" height="600" style="display:none"></canvas>

    <!-- ‚ïê‚ïê GAME SCRIPTS (same order as index.html) ‚ïê‚ïê -->
    <script src="js/secrets.js"></script>
    <script src="js/config.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/audio.js"></script>
    <script src="js/effects.js"></script>
    <script src="js/weapons.js"></script>
    <script src="js/map.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/tutorial.js"></script>
    <!-- <script src="js/ai.js"></script> -->
    <script src="js/entities/base.js"></script>
    <script src="js/entities/player/PlayerBase.js"></script>
    <script src="js/entities/player/Kaoplayer.js"></script>
    <script src="js/entities/player/AutoPlayer.js"></script>
    <script src="js/entities/player/PoomPlayer.js"></script>
    <script src="js/entities/summons.js"></script>
    <script src="js/entities/enemy.js"></script>
    <script src="js/entities/boss_attacks.js"></script>
    <script src="js/entities/boss.js"></script>
    <script src="js/input.js"></script>
    <script src="js/systems/GameState.js"></script>
    <script src="js/systems/AdminSystem.js"></script>
    <script src="js/systems/ShopSystem.js"></script>
    <script src="js/systems/TimeManager.js"></script>
    <script src="js/systems/WaveManager.js"></script>
    <script src="js/game.js"></script>
    <script src="js/VersionManager.js"></script>

    <!-- ‚ïê‚ïê DEBUG UI ‚ïê‚ïê -->
    <div id="app">
        <header class="header">
            <div class="header-top">
                <div class="title-block">
                    <div class="title-eyebrow">‚¨° System Diagnostics v3.6.2</div>
                    <div class="title-main">MTC: <span>Beta</span> Edition</div>
                    <div class="title-sub">Diagnostic Console ¬∑ Runtime Analysis ¬∑ Achievement Inspector ¬∑ BALANCE
                        Viewer</div>
                </div>
                <div class="btn-group">
                    <div class="live-clock" id="live-clock">--:--:--</div>
                    <button class="btn btn-export" onclick="exportReport()">‚¨á Export</button>
                    <button class="btn btn-copy" id="copy-all-btn" onclick="copyAllLogs()">‚éò Copy Logs</button>
                    <button class="btn btn-clear" onclick="clearAll()">‚ü≥ Clear</button>
                    <button class="btn btn-run" id="run-btn" onclick="runAllDiagnostics()">‚ñ∂ Run Diagnostics</button>
                </div>
            </div>
        </header>

        <div class="status-bar">
            <div class="status-bar-dot inactive" id="status-dot"></div>
            <span id="status-text">READY ‚Äî ‡∏Å‡∏î "Run Diagnostics" ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°</span>
            <span class="blink">_</span>
        </div>

        <!-- Quick Stats -->
        <div class="quick-stats" id="quick-stats">
            <div class="qs-card">
                <div class="qs-label">Version</div>
                <div class="qs-value" id="qs-version">‚Äî</div>
                <div class="qs-sub">‡∏à‡∏≤‡∏Å sw.js / VersionManager</div>
            </div>
            <div class="qs-card">
                <div class="qs-label">Achievements</div>
                <div class="qs-value" id="qs-achieve">‚Äî</div>
                <div class="qs-sub">defined ‡πÉ‡∏ô ACHIEVEMENT_DEFS</div>
            </div>
            <div class="qs-card">
                <div class="qs-label">Characters</div>
                <div class="qs-value" id="qs-chars">‚Äî</div>
                <div class="qs-sub">KaoPlayer ¬∑ AutoPlayer ¬∑ PoomPlayer</div>
            </div>
            <div class="qs-card">
                <div class="qs-label">Scripts Loaded</div>
                <div class="qs-value" id="qs-scripts">‚Äî</div>
                <div class="qs-sub">game modules detected</div>
            </div>
            <div class="qs-card">
                <div class="qs-label">Last Run</div>
                <div class="qs-value" id="qs-lastrun" style="font-size:13px">‚Äî</div>
                <div class="qs-sub">timestamp</div>
            </div>
        </div>

        <!-- Progress -->
        <div class="progress-bar-wrap">
            <div class="corner corner-tl"></div>
            <div class="corner corner-tr"></div>
            <div class="corner corner-bl"></div>
            <div class="corner corner-br"></div>
            <div class="progress-header">
                <span class="progress-label">Overall Diagnostic Completion</span>
                <div class="progress-stats">
                    <span class="stat-pass" id="stat-pass">PASS: 0</span>
                    <span class="stat-fail" id="stat-fail">FAIL: 0</span>
                    <span class="stat-warn" id="stat-warn">WARN: 0</span>
                    <span class="stat-total" id="stat-total">TOTAL: 0</span>
                </div>
            </div>
            <div class="progress-track">
                <div class="progress-fill" id="progress-fill"></div>
            </div>
            <div style="display:flex;justify-content:space-between;margin-top:6px;">
                <span style="font-size:10px;color:#334155;">0%</span>
                <span class="progress-pct" id="progress-pct">0%</span>
                <span style="font-size:10px;color:#334155;">100%</span>
            </div>
        </div>

        <!-- Test Sections Grid -->
        <div class="sections-grid" id="sections-grid">

            <div class="section-card" id="sec-core">
                <div class="section-header" onclick="toggleSection('sec-core')">
                    <div class="section-title-wrap">
                        <div class="section-icon ic-engine">‚öôÔ∏è</div>
                        <div>
                            <div class="section-title">Core Engine</div>
                            <div style="font-size:10px;color:#475569;margin-top:1px;">config ¬∑ utils ¬∑ map ¬∑ ui ¬∑ input
                            </div>
                        </div>
                    </div>
                    <div class="section-meta"><span class="mini-badge idle" id="sec-core-badge">IDLE</span><span
                            class="collapse-arrow">‚ñæ</span></div>
                </div>
                <div class="section-body" id="sec-core-body"></div>
            </div>

            <div class="section-card" id="sec-systems">
                <div class="section-header" onclick="toggleSection('sec-systems')">
                    <div class="section-title-wrap">
                        <div class="section-icon ic-system">üîß</div>
                        <div>
                            <div class="section-title">Game Systems</div>
                            <div style="font-size:10px;color:#475569;margin-top:1px;">GameState ¬∑ TimeManager ¬∑
                                WaveManager ¬∑ Shop ¬∑ Admin</div>
                        </div>
                    </div>
                    <div class="section-meta"><span class="mini-badge idle" id="sec-systems-badge">IDLE</span><span
                            class="collapse-arrow">‚ñæ</span></div>
                </div>
                <div class="section-body" id="sec-systems-body"></div>
            </div>

            <div class="section-card" id="sec-entities">
                <div class="section-header" onclick="toggleSection('sec-entities')">
                    <div class="section-title-wrap">
                        <div class="section-icon ic-entity">üéÆ</div>
                        <div>
                            <div class="section-title">Entities &amp; Players</div>
                            <div style="font-size:10px;color:#475569;margin-top:1px;">base ¬∑ enemy ¬∑ boss ¬∑ summons ¬∑
                                KaoPlayer ¬∑ AutoPlayer ¬∑ PoomPlayer</div>
                        </div>
                    </div>
                    <div class="section-meta"><span class="mini-badge idle" id="sec-entities-badge">IDLE</span><span
                            class="collapse-arrow">‚ñæ</span></div>
                </div>
                <div class="section-body" id="sec-entities-body"></div>
            </div>

            <div class="section-card" id="sec-content">
                <div class="section-header" onclick="toggleSection('sec-content')">
                    <div class="section-title-wrap">
                        <div class="section-icon ic-content">üéµ</div>
                        <div>
                            <div class="section-title">Audio &amp; Content</div>
                            <div style="font-size:10px;color:#475569;margin-top:1px;">audio ¬∑ effects ¬∑ weapons ¬∑
                                tutorial ¬∑ secrets</div>
                        </div>
                    </div>
                    <div class="section-meta"><span class="mini-badge idle" id="sec-content-badge">IDLE</span><span
                            class="collapse-arrow">‚ñæ</span></div>
                </div>
                <div class="section-body" id="sec-content-body"></div>
            </div>

            <div class="section-card" id="sec-api">
                <div class="section-header" onclick="toggleSection('sec-api')">
                    <div class="section-title-wrap">
                        <div class="section-icon ic-api">üíæ</div>
                        <div>
                            <div class="section-title">Save &amp; Storage</div>
                            <div style="font-size:10px;color:#475569;margin-top:1px;">localStorage ¬∑ getSaveData ¬∑
                                updateSaveData</div>
                        </div>
                    </div>
                    <div class="section-meta"><span class="mini-badge idle" id="sec-api-badge">IDLE</span><span
                            class="collapse-arrow">‚ñæ</span></div>
                </div>
                <div class="section-body" id="sec-api-body"></div>
            </div>

            <div class="section-card" id="sec-game">
                <div class="section-header" onclick="toggleSection('sec-game')">
                    <div class="section-title-wrap">
                        <div class="section-icon ic-engine">üïπÔ∏è</div>
                        <div>
                            <div class="section-title">Game Core (game.js)</div>
                            <div style="font-size:10px;color:#475569;margin-top:1px;">game loop ¬∑ state ¬∑ canvas ¬∑ init
                                functions</div>
                        </div>
                    </div>
                    <div class="section-meta"><span class="mini-badge idle" id="sec-game-badge">IDLE</span><span
                            class="collapse-arrow">‚ñæ</span></div>
                </div>
                <div class="section-body" id="sec-game-body"></div>
            </div>

            <div class="section-card" id="sec-achieve">
                <div class="section-header" onclick="toggleSection('sec-achieve')">
                    <div class="section-title-wrap">
                        <div class="section-icon ic-achieve">üèÜ</div>
                        <div>
                            <div class="section-title">Achievement System</div>
                            <div style="font-size:10px;color:#475569;margin-top:1px;">AchievementSystem ¬∑
                                ACHIEVEMENT_DEFS ¬∑ Achievements.stats</div>
                        </div>
                    </div>
                    <div class="section-meta"><span class="mini-badge idle" id="sec-achieve-badge">IDLE</span><span
                            class="collapse-arrow">‚ñæ</span></div>
                </div>
                <div class="section-body" id="sec-achieve-body"></div>
            </div>

            <div class="section-card" id="sec-version">
                <div class="section-header" onclick="toggleSection('sec-version')">
                    <div class="section-title-wrap">
                        <div class="section-icon ic-version">üì¶</div>
                        <div>
                            <div class="section-title">Version &amp; ServiceWorker</div>
                            <div style="font-size:10px;color:#475569;margin-top:1px;">VersionManager ¬∑ GAME_VERSION ¬∑
                                sw.js cache</div>
                        </div>
                    </div>
                    <div class="section-meta"><span class="mini-badge idle" id="sec-version-badge">IDLE</span><span
                            class="collapse-arrow">‚ñæ</span></div>
                </div>
                <div class="section-body" id="sec-version-body"></div>
            </div>

        </div>

        <!-- Inspector Tabs -->
        <div class="inspector-wrap">
            <div class="inspector-header">
                <span class="inspector-title">üîç Runtime Inspector</span>
                <span style="font-size:10px;color:#475569;">‡∏≠‡πà‡∏≤‡∏ô‡∏Ñ‡πà‡∏≤ live ‡∏à‡∏≤‡∏Å window ‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢</span>
            </div>
            <div class="tab-bar">
                <button class="tab-btn active" onclick="switchTab('tab-achievements')">üèÜ Achievements</button>
                <button class="tab-btn" onclick="switchTab('tab-balance')">‚öñÔ∏è BALANCE</button>
                <button class="tab-btn" onclick="switchTab('tab-chars')">üë§ Characters</button>
                <button class="tab-btn" onclick="switchTab('tab-gamestate')">üóÇÔ∏è GameState</button>
            </div>

            <!-- Tab: Achievements -->
            <div class="tab-panel active" id="tab-achievements">
                <div
                    style="padding:12px 18px;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:center;">
                    <span style="font-size:11px;color:#475569;">Achievements ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏ó‡∏µ‡πà defined ‡πÉ‡∏ô
                        ACHIEVEMENT_DEFS</span>
                    <button class="btn btn-copy" style="padding:6px 12px;font-size:9px;" onclick="copyAchievements()">‚éò
                        Copy</button>
                </div>
                <div class="achieve-grid" id="achieve-grid">
                    <div style="color:#475569;font-size:11px;padding:20px;">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î... (‡∏£‡∏≠ scripts load)</div>
                </div>
            </div>

            <!-- Tab: BALANCE -->
            <div class="tab-panel" id="tab-balance">
                <div
                    style="padding:12px 18px;border-bottom:1px solid var(--border);display:flex;gap:10px;align-items:center;flex-wrap:wrap;">
                    <span style="font-size:11px;color:#475569;">‡∏Ñ‡πà‡∏≤ BALANCE ‡∏à‡∏≤‡∏Å config.js</span>
                    <select id="balance-section-select" onchange="renderBalanceSection(this.value)"
                        style="background:var(--bg-card);border:1px solid var(--border);color:var(--text);padding:4px 10px;border-radius:3px;font-size:11px;font-family:var(--font-mono);">
                        <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å section --</option>
                    </select>
                    <button class="btn btn-copy" style="padding:6px 12px;font-size:9px;" onclick="copyBalance()">‚éò
                        Copy</button>
                </div>
                <div style="max-height:400px;overflow-y:auto;" id="balance-content">
                    <div style="color:#475569;font-size:11px;padding:20px;">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å section ‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏Ñ‡πà‡∏≤ BALANCE</div>
                </div>
            </div>

            <!-- Tab: Characters -->
            <div class="tab-panel" id="tab-chars">
                <div style="padding:12px 18px;border-bottom:1px solid var(--border);">
                    <span style="font-size:11px;color:#475569;">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ Class ‡πÅ‡∏•‡∏∞ method ‡∏Ç‡∏≠‡∏á player ‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏ï‡∏±‡∏ß</span>
                </div>
                <div id="chars-content"
                    style="padding:14px 18px;display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:14px;">
                    <div style="color:#475569;font-size:11px;">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</div>
                </div>
            </div>

            <!-- Tab: GameState -->
            <div class="tab-panel" id="tab-gamestate">
                <div
                    style="padding:12px 18px;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:center;">
                    <span style="font-size:11px;color:#475569;">‡∏Ñ‡πà‡∏≤ GameState / window globals ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô</span>
                    <button class="btn btn-copy" style="padding:6px 12px;font-size:9px;" onclick="copyGameState()">‚éò
                        Copy</button>
                </div>
                <div id="gamestate-content" style="max-height:400px;overflow-y:auto;padding:14px 18px;">
                    <div style="color:#475569;font-size:11px;">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</div>
                </div>
            </div>
        </div>

        <!-- Console Output -->
        <div class="console-wrap">
            <div class="console-header">
                <div class="console-dots">
                    <div class="console-dot dot-red"></div>
                    <div class="console-dot dot-yellow"></div>
                    <div class="console-dot dot-green"></div>
                </div>
                <span class="console-title">Diagnostic Console Output</span>
                <div class="console-actions">
                    <button class="btn btn-copy" id="copy-log-btn" style="padding:5px 12px;font-size:9px;"
                        onclick="copyConsoleLogs()">‚éò Copy</button>
                    <span style="font-size:10px;color:#334155;">stdout</span>
                </div>
            </div>
            <div id="console-output">
                <span class="log-system"><span class="log-prompt">$</span> MTC Diagnostic System v3.6.2 ready.</span>
                <span class="log-system"><span class="log-prompt">$</span> ‡∏Å‡∏î "‚ñ∂ Run Diagnostics"
                    ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏£‡∏∞‡∏ö‡∏ö...</span>
            </div>
        </div>

        <div class="footer">MTC the Game Beta Edition ¬∑ Diagnostic Tool v3.6.2 ¬∑ by Mawin</div>
    </div>

    <!-- Toast notification -->
    <div id="copy-toast">‚úì Copied to clipboard!</div>

    <!-- ‚ïê‚ïê DIAGNOSTIC ENGINE ‚ïê‚ïê -->
    <script>
        (function () {
            'use strict';

            // ‚îÄ‚îÄ Intercept game bootstrap ‚îÄ‚îÄ
            window.startGame = () => diag.log('[Intercepted] startGame() ‚Äî blocked on debug page.', 'warn');
            window.loopRunning = true;

            const state = {
                running: false,
                results: [],
                logLines: [],
            };

            // ‚îÄ‚îÄ Live Clock ‚îÄ‚îÄ
            function tickClock() {
                const d = new Date(), pad = n => String(n).padStart(2, '0');
                document.getElementById('live-clock').textContent = `${pad(d.getHours())}:${pad(d.getMinutes())}:${pad(d.getSeconds())}`;
            }
            setInterval(tickClock, 1000); tickClock();

            // ‚îÄ‚îÄ Toast ‚îÄ‚îÄ
            function showToast(msg = '‚úì Copied!') {
                const t = document.getElementById('copy-toast');
                t.textContent = msg;
                t.classList.add('show');
                setTimeout(() => t.classList.remove('show'), 2000);
            }

            // ‚îÄ‚îÄ Diag Logger ‚îÄ‚îÄ
            const diag = {
                log(msg, type = 'info') {
                    const el = document.getElementById('console-output');
                    const cls = { success: 'log-success', error: 'log-error', warn: 'log-warn', info: 'log-info', system: 'log-system' }[type] || 'log-info';
                    const prefix = { success: '‚úî', error: '‚úñ', warn: '‚ö†', info: 'i', system: '$' }[type] || '>';
                    const line = `<span class="${cls}"><span class="log-prompt">${prefix}</span> ${msg}</span>\n`;
                    el.innerHTML += line;
                    el.scrollTop = el.scrollHeight;
                    state.logLines.push(`[${type.toUpperCase()}] ${msg}`);
                },
                sep(label = '') {
                    const el = document.getElementById('console-output');
                    const txt = label ? `‚îÄ‚îÄ‚îÄ ${label} ‚îÄ‚îÄ‚îÄ` : '‚îÄ'.repeat(60);
                    el.innerHTML += `<span class="log-sep">${txt}</span>\n`;
                    state.logLines.push(`--- ${label || '---'}`);
                }
            };

            // ‚îÄ‚îÄ Progress ‚îÄ‚îÄ
            function updateProgress() {
                const total = state.results.length;
                const passed = state.results.filter(r => r.status === 'pass').length;
                const failed = state.results.filter(r => r.status === 'fail').length;
                const warned = state.results.filter(r => r.status === 'warn').length;
                const pct = total ? Math.round((passed + warned) / total * 100) : 0;

                document.getElementById('stat-pass').textContent = `PASS: ${passed}`;
                document.getElementById('stat-fail').textContent = `FAIL: ${failed}`;
                document.getElementById('stat-warn').textContent = `WARN: ${warned}`;
                document.getElementById('stat-total').textContent = `TOTAL: ${total}`;
                document.getElementById('progress-fill').style.width = `${pct}%`;
                document.getElementById('progress-pct').textContent = `${pct}%`;
            }

            // ‚îÄ‚îÄ Render test row ‚îÄ‚îÄ
            function renderTestRow(bodyId, name, status, tip = '') {
                const body = document.getElementById(bodyId);
                let row = body.querySelector(`[data-test="${CSS.escape(name)}"]`);
                if (!row) {
                    row = document.createElement('div');
                    row.className = 'test-item';
                    row.dataset.test = name;
                    body.appendChild(row);
                }
                row.setAttribute('data-tip', tip);
                row.innerHTML = `
            <div class="test-left">
                <div class="test-indicator ${status}"></div>
                <span class="test-name">${name}</span>
            </div>
            <div class="test-right">
                <span class="status-badge ${status}">${status.toUpperCase()}</span>
            </div>`;
            }

            // ‚îÄ‚îÄ Section badge ‚îÄ‚îÄ
            function updateSectionBadge(sectionId) {
                const badge = document.getElementById(`${sectionId}-badge`);
                if (!badge) return;
                const body = document.getElementById(`${sectionId}-body`);
                const indicators = body ? Array.from(body.querySelectorAll('.test-indicator')) : [];
                const statuses = indicators.map(i => [...i.classList].find(c => ['pass', 'fail', 'warn', 'running', 'idle'].includes(c)));
                const anyFail = statuses.some(s => s === 'fail');
                const anyWarn = statuses.some(s => s === 'warn');
                const allPending = statuses.every(s => s === 'idle' || s === 'running');
                if (anyFail) { badge.className = 'mini-badge fail'; badge.textContent = 'ISSUES'; }
                else if (anyWarn) { badge.className = 'mini-badge warn'; badge.textContent = 'WARN'; }
                else if (allPending) { badge.className = 'mini-badge idle'; badge.textContent = 'IDLE'; }
                else { badge.className = 'mini-badge pass'; badge.textContent = 'OK'; }
            }

            // ‚îÄ‚îÄ Toggle section collapse ‚îÄ‚îÄ
            window.toggleSection = function (id) {
                document.getElementById(id)?.classList.toggle('collapsed');
            };

            // ‚îÄ‚îÄ Tab switcher ‚îÄ‚îÄ
            window.switchTab = function (tabId) {
                document.querySelectorAll('.tab-panel').forEach(p => p.classList.remove('active'));
                document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                document.getElementById(tabId)?.classList.add('active');
                event.target.classList.add('active');
                // Refresh content on switch
                if (tabId === 'tab-achievements') renderAchievements();
                if (tabId === 'tab-balance') renderBalanceSections();
                if (tabId === 'tab-chars') renderChars();
                if (tabId === 'tab-gamestate') renderGameState();
            };

            // ‚îÄ‚îÄ Assertion helpers ‚îÄ‚îÄ
            function isDefined(path, pred = null) {
                try {
                    const parts = path.replace(/^window\./, '').split('.');
                    let obj = window;
                    for (const p of parts) {
                        if (obj == null || !(p in Object(obj))) return false;
                        obj = obj[p];
                    }
                    if (obj === undefined || obj === null) return false;
                    if (pred) return pred(obj);
                    return true;
                } catch { return false; }
            }
            function isClass(path) { return isDefined(path, v => typeof v === 'function'); }
            function isObject(path) { return isDefined(path, v => typeof v === 'object'); }
            function isFunction(path) { return isDefined(path, v => typeof v === 'function'); }

            // ‚îÄ‚îÄ Run single test ‚îÄ‚îÄ
            async function runTest(sectionId, bodyId, name, testFn, failTip = '') {
                const record = { sectionId, name, status: 'running' };
                state.results.push(record);
                renderTestRow(bodyId, name, 'running');
                let status = 'fail', tip = failTip;
                try {
                    const result = await testFn();
                    if (result === true) { status = 'pass'; tip = ''; }
                    else if (result === 'warn') { status = 'warn'; tip = failTip; }
                    else { status = 'fail'; }
                } catch (err) {
                    status = 'fail'; tip = `Exception: ${err.message}`;
                    diag.log(`  ‚úñ Exception in "${name}": ${err.message}`, 'error');
                }
                record.status = status;
                renderTestRow(bodyId, name, status, tip);
                updateSectionBadge(sectionId);
                updateProgress();
                return status;
            }

            // ‚îÄ‚îÄ Clear ‚îÄ‚îÄ
            window.clearAll = function () {
                const el = document.getElementById('console-output');
                el.innerHTML = `<span class="log-system"><span class="log-prompt">$</span> Console cleared. Ready.</span>\n`;
                document.querySelectorAll('.section-body').forEach(b => b.innerHTML = '');
                state.results = []; state.logLines = [];
                updateProgress();
                ['sec-core', 'sec-systems', 'sec-entities', 'sec-content', 'sec-api', 'sec-game', 'sec-achieve', 'sec-version']
                    .forEach(id => {
                        const badge = document.getElementById(`${id}-badge`);
                        if (badge) { badge.className = 'mini-badge idle'; badge.textContent = 'IDLE'; }
                    });
                setStatus('READY ‚Äî Logs cleared.', false);
            };

            // ‚îÄ‚îÄ Status bar ‚îÄ‚îÄ
            function setStatus(msg, active = true) {
                document.getElementById('status-text').textContent = msg;
                document.getElementById('status-dot').classList.toggle('inactive', !active);
            }

            // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
            // INSPECTOR RENDERERS
            // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

            function renderAchievements() {
                const grid = document.getElementById('achieve-grid');
                if (!window.ACHIEVEMENT_DEFS) {
                    grid.innerHTML = `<div style="color:var(--danger);font-size:11px;padding:10px;">ACHIEVEMENT_DEFS ‡πÑ‡∏°‡πà‡∏û‡∏ö ‚Äî config.js ‡∏≠‡∏≤‡∏à‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÇ‡∏´‡∏•‡∏î</div>`;
                    return;
                }
                grid.innerHTML = window.ACHIEVEMENT_DEFS.map(a => `
            <div class="achieve-item">
                <div class="a-icon">${a.icon}</div>
                <div class="a-id">${a.id}</div>
                <div class="a-name">${a.name}</div>
                <div class="a-desc">${a.desc}</div>
            </div>
        `).join('');
                document.getElementById('qs-achieve').textContent = window.ACHIEVEMENT_DEFS.length;
                document.getElementById('qs-achieve').className = 'qs-value ok';
            }

            function renderBalanceSections() {
                const sel = document.getElementById('balance-section-select');
                if (!window.BALANCE) {
                    document.getElementById('balance-content').innerHTML = `<div style="color:var(--danger);font-size:11px;padding:20px;">BALANCE ‡πÑ‡∏°‡πà‡∏û‡∏ö ‚Äî config.js ‡∏≠‡∏≤‡∏à‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÇ‡∏´‡∏•‡∏î</div>`;
                    return;
                }
                sel.innerHTML = '<option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å section --</option>' +
                    Object.keys(window.BALANCE).map(k => `<option value="${k}">${k}</option>`).join('');
            }

            window.renderBalanceSection = function (key) {
                const content = document.getElementById('balance-content');
                if (!key || !window.BALANCE) return;
                const section = window.BALANCE[key];
                if (typeof section !== 'object' || section === null) {
                    content.innerHTML = `<div style="padding:14px 18px;color:var(--text-bright);">${JSON.stringify(section)}</div>`;
                    return;
                }
                const rows = Object.entries(section).map(([k, v]) => {
                    const type = Array.isArray(v) ? 'array' : typeof v;
                    const display = typeof v === 'object' ? JSON.stringify(v) : String(v);
                    return `<tr><td class="balance-key">${k}</td><td class="balance-value">${display}</td><td class="balance-type">${type}</td></tr>`;
                }).join('');
                content.innerHTML = `<table class="balance-table"><thead><tr><th>Key</th><th>Value</th><th>Type</th></tr></thead><tbody>${rows}</tbody></table>`;
            };

            function renderChars() {
                const container = document.getElementById('chars-content');
                const chars = [
                    { name: 'KaoPlayer', cls: window.KaoPlayer, color: '#60a5fa', methods: ['addKill', 'teleport', 'fireWeapon'] },
                    { name: 'AutoPlayer', cls: window.AutoPlayer, color: '#ef4444', methods: ['_activateWanchai', 'update', 'takeDamage'] },
                    { name: 'PoomPlayer', cls: window.PoomPlayer, color: '#10b981', methods: ['ritualBurst', 'applySticky', 'update'] },
                ];
                container.innerHTML = chars.map(c => {
                    const loaded = !!c.cls;
                    const methodChecks = c.methods.map(m => {
                        const ok = loaded && typeof c.cls.prototype[m] === 'function';
                        return `<div style="display:flex;justify-content:space-between;font-size:10px;padding:3px 0;border-bottom:1px solid rgba(26,39,68,0.4);">
                    <span style="color:var(--text);">${m}()</span>
                    <span style="color:${ok ? 'var(--success)' : 'var(--danger);'}">${ok ? '‚úî' : '‚úñ'}</span>
                </div>`;
                    }).join('');
                    return `<div style="background:var(--bg-panel);border:1px solid var(--border);border-radius:5px;padding:14px;border-top:2px solid ${c.color};">
                <div style="font-family:var(--font-display);font-size:11px;color:${c.color};letter-spacing:2px;margin-bottom:10px;">${c.name} ${loaded ? '‚úî Loaded' : '‚úñ NOT FOUND'}</div>
                ${methodChecks}
            </div>`;
                }).join('');
                // QS
                const loaded = chars.filter(c => !!c.cls).length;
                document.getElementById('qs-chars').textContent = `${loaded}/3`;
                document.getElementById('qs-chars').className = `qs-value ${loaded === 3 ? 'ok' : 'err'}`;
            }

            function renderGameState() {
                const content = document.getElementById('gamestate-content');
                const keys = ['phase', 'loopRunning', 'timeScale', 'isSlowMotion', 'slowMoEnergy', 'isGlitchWave', 'bossEncounterCount'];
                const GS = window.GameState;
                if (!GS) {
                    content.innerHTML = `<div style="color:var(--danger);font-size:11px;">GameState ‡πÑ‡∏°‡πà‡∏û‡∏ö ‚Äî systems/GameState.js ‡∏≠‡∏≤‡∏à‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÇ‡∏´‡∏•‡∏î</div>`;
                    return;
                }
                const rows = keys.map(k => {
                    const v = GS[k];
                    return `<div style="display:flex;justify-content:space-between;padding:6px 0;border-bottom:1px solid rgba(26,39,68,0.4);font-size:11px;">
                <span style="color:var(--accent);">${k}</span>
                <span style="color:var(--text-bright);">${JSON.stringify(v)}</span>
            </div>`;
                }).join('');
                content.innerHTML = `<div>${rows}</div>
            <div style="margin-top:12px;font-size:10px;color:#475569;">enemies: ${GS.enemies?.length ?? '?'} ¬∑ powerups: ${GS.powerups?.length ?? '?'}</div>`;
            }

            // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
            // COPY / EXPORT
            // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

            window.copyConsoleLogs = function () {
                const text = state.logLines.join('\n');
                navigator.clipboard.writeText(text).then(() => showToast('‚úì Console logs copied!')).catch(() => {
                    const ta = document.createElement('textarea');
                    ta.value = text; document.body.appendChild(ta); ta.select(); document.execCommand('copy'); ta.remove();
                    showToast('‚úì Copied!');
                });
                const btn = document.getElementById('copy-log-btn');
                btn.textContent = '‚úì Copied!'; btn.classList.add('copied');
                setTimeout(() => { btn.textContent = '‚éò Copy'; btn.classList.remove('copied'); }, 2000);
            };

            window.copyAllLogs = function () {
                const pass = state.results.filter(r => r.status === 'pass').length;
                const fail = state.results.filter(r => r.status === 'fail').length;
                const warn = state.results.filter(r => r.status === 'warn').length;
                const header = `=== MTC Diagnostic Report v3.6.2 ===\nDate: ${new Date().toLocaleString('th-TH')}\nPASS: ${pass} | FAIL: ${fail} | WARN: ${warn}\n\n`;
                const results = state.results.map(r => `[${r.status.toUpperCase().padEnd(4)}] ${r.name}`).join('\n');
                const logs = '\n--- Console Logs ---\n' + state.logLines.join('\n');
                navigator.clipboard.writeText(header + results + logs).then(() => showToast('‚úì Full report copied!')).catch(() => { });
                const btn = document.getElementById('copy-all-btn');
                btn.textContent = '‚úì Copied!'; btn.classList.add('copied');
                setTimeout(() => { btn.textContent = '‚éò Copy Logs'; btn.classList.remove('copied'); }, 2000);
            };

            window.copyAchievements = function () {
                if (!window.ACHIEVEMENT_DEFS) return;
                const text = window.ACHIEVEMENT_DEFS.map(a => `${a.icon} [${a.id}] ${a.name} ‚Äî ${a.desc}`).join('\n');
                navigator.clipboard.writeText(text).then(() => showToast('‚úì Achievements copied!')).catch(() => { });
            };

            window.copyBalance = function () {
                const key = document.getElementById('balance-section-select').value;
                if (!key || !window.BALANCE) return;
                const text = `BALANCE.${key}:\n` + JSON.stringify(window.BALANCE[key], null, 2);
                navigator.clipboard.writeText(text).then(() => showToast(`‚úì BALANCE.${key} copied!`)).catch(() => { });
            };

            window.copyGameState = function () {
                if (!window.GameState) return;
                const text = JSON.stringify(window.GameState, (k, v) => typeof v === 'function' ? '[Function]' : v, 2);
                navigator.clipboard.writeText(text).then(() => showToast('‚úì GameState copied!')).catch(() => { });
            };

            window.exportReport = function () {
                const pass = state.results.filter(r => r.status === 'pass').length;
                const fail = state.results.filter(r => r.status === 'fail').length;
                const warn = state.results.filter(r => r.status === 'warn').length;
                const content = `MTC Diagnostic Report v3.6.2\nDate: ${new Date().toLocaleString('th-TH')}\nPASS: ${pass} | FAIL: ${fail} | WARN: ${warn}\n\n` +
                    state.results.map(r => `[${r.status.toUpperCase().padEnd(4)}] ${r.name}`).join('\n') +
                    '\n\n--- Console Logs ---\n' + state.logLines.join('\n');
                const blob = new Blob([content], { type: 'text/plain' });
                const a = document.createElement('a');
                a.href = URL.createObjectURL(blob);
                a.download = `mtc-diag-${new Date().toISOString().slice(0, 10)}.txt`;
                a.click();
            };

            // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
            // MAIN DIAGNOSTIC RUNNER
            // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
            window.runAllDiagnostics = async function () {
                if (state.running) return;
                state.running = true;
                clearAll();
                document.getElementById('run-btn').disabled = true;
                setStatus('RUNNING ‚Äî ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏£‡∏∞‡∏ö‡∏ö...', true);

                const now = new Date();
                document.getElementById('qs-lastrun').textContent = `${now.getHours()}:${String(now.getMinutes()).padStart(2, '0')}:${String(now.getSeconds()).padStart(2, '0')}`;

                diag.log('Dummy DOM active: element IDs ‡∏Ñ‡∏£‡∏ö‡∏ï‡∏≤‡∏° index.html', 'success');
                diag.sep();

                const T = (secId, bodyId, name, testFn, failTip) => runTest(secId, bodyId, name, testFn, failTip);
                const delay = ms => new Promise(r => setTimeout(r, ms));

                // ‚îÄ‚îÄ 1. CORE ENGINE ‚îÄ‚îÄ
                diag.sep('1. CORE ENGINE');

                await T('sec-core', 'sec-core-body', 'BALANCE defined',
                    () => isDefined('window.BALANCE'),
                    'Failed: BALANCE undefined ‚Äî check config.js');
                await T('sec-core', 'sec-core-body', 'MAP_CONFIG defined',
                    () => isDefined('window.MAP_CONFIG'),
                    'Failed: MAP_CONFIG undefined ‚Äî check config.js');
                await T('sec-core', 'sec-core-body', 'GAME_TEXTS defined',
                    () => isDefined('window.GAME_TEXTS'),
                    'Failed: GAME_TEXTS undefined ‚Äî check config.js');
                await T('sec-core', 'sec-core-body', 'ACHIEVEMENT_DEFS defined',
                    () => isDefined('window.ACHIEVEMENT_DEFS') && Array.isArray(window.ACHIEVEMENT_DEFS),
                    'Failed: ACHIEVEMENT_DEFS undefined ‚Äî check config.js');
                await T('sec-core', 'sec-core-body', 'getDeltaTime() utility',
                    () => isFunction('window.getDeltaTime'),
                    'Failed: getDeltaTime ‡πÑ‡∏°‡πà‡∏û‡∏ö ‚Äî check utils.js');
                await T('sec-core', 'sec-core-body', 'clamp() / lerp() math utils',
                    () => isFunction('window.clamp') || isFunction('window.lerp'),
                    'Failed: clamp/lerp ‡πÑ‡∏°‡πà‡∏û‡∏ö ‚Äî check utils.js');
                await T('sec-core', 'sec-core-body', 'mapSystem object',
                    () => isObject('window.mapSystem'),
                    'Failed: mapSystem undefined ‚Äî check map.js');
                await T('sec-core', 'sec-core-body', 'UIManager defined',
                    () => isDefined('window.UIManager'),
                    'Failed: UIManager undefined ‚Äî check ui.js');
                await T('sec-core', 'sec-core-body', 'Achievements instance',
                    () => isDefined('window.Achievements') && typeof window.Achievements.check === 'function',
                    'Failed: Achievements instance ‡πÑ‡∏°‡πà‡∏û‡∏ö ‚Äî check ui.js');
                await T('sec-core', 'sec-core-body', 'Input System (keys)',
                    () => isObject('window.inputSystem') || isDefined('window.keys'),
                    'Failed: input system ‡πÑ‡∏°‡πà‡∏û‡∏ö ‚Äî check input.js');
                await delay(50);

                // ‚îÄ‚îÄ 2. GAME SYSTEMS ‚îÄ‚îÄ
                diag.sep('2. GAME SYSTEMS');

                await T('sec-systems', 'sec-systems-body', 'GameState object',
                    () => isObject('window.GameState') && typeof window.GameState.setPhase === 'function',
                    'Failed: GameState ‡πÑ‡∏°‡πà‡∏û‡∏ö ‚Äî check systems/GameState.js');
                await T('sec-systems', 'sec-systems-body', 'GameState.resetRun()',
                    () => isFunction('window.GameState.resetRun'),
                    'Failed: GameState.resetRun ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà function');
                await T('sec-systems', 'sec-systems-body', 'TimeManager (toggleSlowMotion)',
                    () => isFunction('window.toggleSlowMotion') && isFunction('window._tickSlowMoEnergy'),
                    'Failed: TimeManager functions ‡πÑ‡∏°‡πà‡∏û‡∏ö ‚Äî check systems/TimeManager.js');
                await T('sec-systems', 'sec-systems-body', 'triggerHitStop()',
                    () => isFunction('window.triggerHitStop'),
                    'Failed: triggerHitStop ‡πÑ‡∏°‡πà‡∏û‡∏ö ‚Äî check systems/TimeManager.js');
                await T('sec-systems', 'sec-systems-body', 'WaveManager (startNextWave)',
                    () => isFunction('window.startNextWave'),
                    'Failed: startNextWave ‡πÑ‡∏°‡πà‡∏û‡∏ö ‚Äî check systems/WaveManager.js');
                await T('sec-systems', 'sec-systems-body', 'ShopSystem / ShopManager',
                    () => isObject('window.ShopSystem') || isObject('window.ShopManager') || isClass('window.ShopSystem') || isClass('window.ShopManager'),
                    'Failed: ShopSystem ‡πÑ‡∏°‡πà‡∏û‡∏ö ‚Äî check systems/ShopSystem.js');
                await T('sec-systems', 'sec-systems-body', 'AdminSystem / AdminConsole',
                    () => isObject('window.AdminSystem') || isObject('window.AdminConsole') || isClass('window.AdminSystem') || isClass('window.AdminConsole'),
                    'Failed: AdminSystem ‡πÑ‡∏°‡πà‡∏û‡∏ö ‚Äî check systems/AdminSystem.js');
                await T('sec-systems', 'sec-systems-body', 'TutorialSystem',
                    () => isObject('window.TutorialSystem') || isClass('window.TutorialSystem'),
                    'Failed: TutorialSystem ‡πÑ‡∏°‡πà‡∏û‡∏ö ‚Äî check tutorial.js');
                await delay(50);

                // ‚îÄ‚îÄ 3. ENTITIES & PLAYERS ‚îÄ‚îÄ
                diag.sep('3. ENTITIES & PLAYERS');

                await T('sec-entities', 'sec-entities-body', 'Base Entity class',
                    () => isClass('window.Entity') || isClass('window.EntityBase'),
                    'Failed: Entity class ‡πÑ‡∏°‡πà‡∏û‡∏ö ‚Äî check entities/base.js');
                await T('sec-entities', 'sec-entities-body', 'Player base class',
                    () => isClass('window.Player') || isClass('window.PlayerBase'),
                    'Failed: Player base ‡πÑ‡∏°‡πà‡∏û‡∏ö ‚Äî check entities/player/PlayerBase.js');
                await T('sec-entities', 'sec-entities-body', 'KaoPlayer class',
                    () => isClass('window.KaoPlayer'),
                    'Failed: KaoPlayer ‡πÑ‡∏°‡πà‡∏û‡∏ö ‚Äî check entities/player/Kaoplayer.js');
                await T('sec-entities', 'sec-entities-body', 'KaoPlayer.addKill() method',
                    () => typeof window.KaoPlayer?.prototype?.addKill === 'function',
                    'Failed: KaoPlayer.addKill ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà function');
                await T('sec-entities', 'sec-entities-body', 'KaoPlayer.isWeaponMaster property (prototype)',
                    () => isDefined('window.KaoPlayer') && 'isWeaponMaster' in (new window.KaoPlayer(0, 0)),
                    'Failed: isWeaponMaster ‡πÑ‡∏°‡πà‡∏û‡∏ö‡πÉ‡∏ô KaoPlayer instance');
                await T('sec-entities', 'sec-entities-body', 'AutoPlayer class',
                    () => isClass('window.AutoPlayer'),
                    'Failed: AutoPlayer ‡πÑ‡∏°‡πà‡∏û‡∏ö ‚Äî check entities/player/AutoPlayer.js');
                await T('sec-entities', 'sec-entities-body', 'AutoPlayer._activateWanchai()',
                    () => typeof window.AutoPlayer?.prototype?._activateWanchai === 'function',
                    'Failed: _activateWanchai ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà function');
                await T('sec-entities', 'sec-entities-body', 'PoomPlayer class',
                    () => isClass('window.PoomPlayer'),
                    'Failed: PoomPlayer ‡πÑ‡∏°‡πà‡∏û‡∏ö ‚Äî check entities/player/PoomPlayer.js');
                await T('sec-entities', 'sec-entities-body', 'PoomPlayer.ritualBurst()',
                    () => typeof window.PoomPlayer?.prototype?.ritualBurst === 'function',
                    'Failed: ritualBurst ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà function');
                await T('sec-entities', 'sec-entities-body', 'Enemy class',
                    () => isClass('window.Enemy'),
                    'Failed: Enemy ‡πÑ‡∏°‡πà‡∏û‡∏ö ‚Äî check entities/enemy.js');
                await T('sec-entities', 'sec-entities-body', 'TankEnemy & MageEnemy classes',
                    () => isClass('window.TankEnemy') && isClass('window.MageEnemy'),
                    'Failed: TankEnemy ‡∏´‡∏£‡∏∑‡∏≠ MageEnemy ‡πÑ‡∏°‡πà‡∏û‡∏ö ‚Äî check entities/enemy.js');
                await T('sec-entities', 'sec-entities-body', 'Boss class (Kru Manop)',
                    () => isClass('window.Boss'),
                    'Failed: Boss ‡πÑ‡∏°‡πà‡∏û‡∏ö ‚Äî check entities/boss.js');
                await T('sec-entities', 'sec-entities-body', 'BossFirst class (Kru First)',
                    () => isClass('window.BossFirst'),
                    'Failed: BossFirst ‡πÑ‡∏°‡πà‡∏û‡∏ö ‚Äî check entities/boss.js');
                await T('sec-entities', 'sec-entities-body', 'Summons (NagaEntity / DroneEntity)',
                    () => isClass('window.NagaEntity') || isClass('window.DroneEntity'),
                    'Failed: Summon class ‡πÑ‡∏°‡πà‡∏û‡∏ö ‚Äî check entities/summons.js');
                await T('sec-entities', 'sec-entities-body', 'weaponSystem object',
                    () => isObject('window.weaponSystem'),
                    'Failed: weaponSystem ‡πÑ‡∏°‡πà‡∏û‡∏ö ‚Äî check weapons.js');
                await delay(50);

                // ‚îÄ‚îÄ 4. AUDIO & CONTENT ‚îÄ‚îÄ
                diag.sep('4. AUDIO & CONTENT');

                await T('sec-content', 'sec-content-body', 'Audio system (Audio.init)',
                    () => isFunction('window.Audio.init') || isObject('window.audioSystem'),
                    'Failed: Audio system ‡πÑ‡∏°‡πà‡∏û‡∏ö ‚Äî check audio.js');
                await T('sec-content', 'sec-content-body', 'Audio.playEnemyDeath()',
                    () => isFunction('window.Audio.playEnemyDeath'),
                    'Failed: Audio.playEnemyDeath ‡πÑ‡∏°‡πà‡∏û‡∏ö ‚Äî check audio.js');
                await T('sec-content', 'sec-content-body', 'spawnParticles()',
                    () => isFunction('window.spawnParticles'),
                    'Failed: spawnParticles ‡πÑ‡∏°‡πà‡∏û‡∏ö ‚Äî check effects.js');
                await T('sec-content', 'sec-content-body', 'spawnFloatingText()',
                    () => isFunction('window.spawnFloatingText'),
                    'Failed: spawnFloatingText ‡πÑ‡∏°‡πà‡∏û‡∏ö ‚Äî check effects.js');
                await T('sec-content', 'sec-content-body', 'PorkSandwich entity',
                    () => isClass('window.PorkSandwich'),
                    'Failed: PorkSandwich ‡πÑ‡∏°‡πà‡∏û‡∏ö ‚Äî check effects.js');
                await T('sec-content', 'sec-content-body', 'weaponSystem.shoot()',
                    () => isDefined('window.weaponSystem.shoot', v => typeof v === 'function'),
                    'Failed: weaponSystem.shoot ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà function');
                await T('sec-content', 'sec-content-body', 'CONFIG_SECRETS (secrets.js)',
                    () => isObject('window.CONFIG_SECRETS'),
                    'Failed: CONFIG_SECRETS ‡πÑ‡∏°‡πà‡∏û‡∏ö ‚Äî check secrets.js');
                await delay(50);

                // ‚îÄ‚îÄ 5. SAVE & STORAGE ‚îÄ‚îÄ
                diag.sep('5. SAVE & STORAGE');

                await T('sec-api', 'sec-api-body', 'localStorage available',
                    () => {
                        try { localStorage.setItem('__mtc_diag__', '1'); localStorage.removeItem('__mtc_diag__'); return true; }
                        catch { return false; }
                    },
                    'Failed: localStorage ‡πÑ‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô (private mode?)');
                await T('sec-api', 'sec-api-body', 'getSaveData()',
                    () => isFunction('window.getSaveData'),
                    'Failed: getSaveData ‡πÑ‡∏°‡πà‡∏û‡∏ö ‚Äî check utils.js');
                await T('sec-api', 'sec-api-body', 'updateSaveData()',
                    () => isFunction('window.updateSaveData'),
                    'Failed: updateSaveData ‡πÑ‡∏°‡πà‡∏û‡∏ö ‚Äî check utils.js');
                await delay(50);

                // ‚îÄ‚îÄ 6. GAME CORE ‚îÄ‚îÄ
                diag.sep('6. GAME CORE (game.js)');

                await T('sec-game', 'sec-game-body', 'Canvas element accessible',
                    () => !!(document.getElementById('__real_canvas__') || document.getElementById('gameCanvas')),
                    'Failed: canvas ‡πÑ‡∏°‡πà‡∏û‡∏ö‡πÉ‡∏ôDOM');
                await T('sec-game', 'sec-game-body', 'Canvas 2D context obtainable',
                    () => {
                        try { const cv = document.getElementById('__real_canvas__') || document.getElementById('gameCanvas'); return !!(cv && cv.getContext('2d')); }
                        catch { return false; }
                    },
                    'Failed: ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ get 2D context ‡πÑ‡∏î‡πâ');
                await T('sec-game', 'sec-game-body', 'gameState / GameState.phase',
                    () => isDefined('window.gameState') || isDefined('window.GameState.phase'),
                    'Failed: game state ‡πÑ‡∏°‡πà‡∏û‡∏ö ‚Äî check game.js');
                await T('sec-game', 'sec-game-body', 'startGame()',
                    () => isFunction('window.startGame'),
                    'Failed: startGame ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà function ‚Äî check game.js');
                await T('sec-game', 'sec-game-body', 'gameLoop() / game loop',
                    () => isFunction('window.gameLoop') || isFunction('window.tick') || isFunction('window.update'),
                    'Failed: game loop ‡πÑ‡∏°‡πà‡∏û‡∏ö ‚Äî check game.js');
                await T('sec-game', 'sec-game-body', 'endGame()',
                    () => isFunction('window.endGame'),
                    'Failed: endGame ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà function ‚Äî check game.js');
                await T('sec-game', 'sec-game-body', 'addScore()',
                    () => isFunction('window.addScore'),
                    'Failed: addScore ‡πÑ‡∏°‡πà‡∏û‡∏ö ‚Äî check game.js');
                await T('sec-game', 'sec-game-body', 'getWave()',
                    () => isFunction('window.getWave'),
                    'Failed: getWave ‡πÑ‡∏°‡πà‡∏û‡∏ö ‚Äî check game.js ‡∏´‡∏£‡∏∑‡∏≠ WaveManager.js');
                await delay(50);

                // ‚îÄ‚îÄ 7. ACHIEVEMENT SYSTEM ‚îÄ‚îÄ
                diag.sep('7. ACHIEVEMENT SYSTEM');

                await T('sec-achieve', 'sec-achieve-body', 'AchievementSystem class',
                    () => isDefined('window.Achievements') && window.Achievements.constructor?.name === 'AchievementSystem',
                    'Failed: AchievementSystem ‡πÑ‡∏°‡πà‡∏û‡∏ö ‚Äî check ui.js');
                await T('sec-achieve', 'sec-achieve-body', 'Achievements instance (window.Achievements)',
                    () => isDefined('window.Achievements') && typeof window.Achievements.check === 'function',
                    'Failed: Achievements instance ‡πÑ‡∏°‡πà‡∏û‡∏ö ‚Äî check ui.js');
                await T('sec-achieve', 'sec-achieve-body', 'Achievements.stats object',
                    () => isObject('window.Achievements.stats'),
                    'Failed: Achievements.stats ‡πÑ‡∏°‡πà‡∏û‡∏ö');
                await T('sec-achieve', 'sec-achieve-body', 'Achievements.stats.slowMoKills (new)',
                    () => isDefined('window.Achievements.stats.slowMoKills') && typeof window.Achievements.stats.slowMoKills === 'number',
                    'Failed: slowMoKills ‡πÑ‡∏°‡πà‡∏û‡∏ö‡πÉ‡∏ô stats ‚Äî check ui.js constructor');
                await T('sec-achieve', 'sec-achieve-body', 'Achievements.stats.barrelKills (new)',
                    () => isDefined('window.Achievements.stats.barrelKills') && typeof window.Achievements.stats.barrelKills === 'number',
                    'Failed: barrelKills ‡πÑ‡∏°‡πà‡∏û‡∏ö‡πÉ‡∏ô stats ‚Äî check ui.js constructor');
                await T('sec-achieve', 'sec-achieve-body', 'Achievements.stats.wanchaiKills (new)',
                    () => isDefined('window.Achievements.stats.wanchaiKills') && typeof window.Achievements.stats.wanchaiKills === 'number',
                    'Failed: wanchaiKills ‡πÑ‡∏°‡πà‡∏û‡∏ö‡πÉ‡∏ô stats ‚Äî check ui.js constructor');
                await T('sec-achieve', 'sec-achieve-body', 'ACHIEVEMENT_DEFS ‡∏Ñ‡∏£‡∏ö 22 ‡∏Ç‡πâ‡∏≠',
                    () => {
                        const defs = window.ACHIEVEMENT_DEFS;
                        if (!defs) return false;
                        if (defs.length < 20) { diag.log(`  ! ACHIEVEMENT_DEFS ‡∏°‡∏µ‡πÅ‡∏Ñ‡πà ${defs.length} ‡∏Ç‡πâ‡∏≠`, 'warn'); return 'warn'; }
                        return true;
                    },
                    'WARN: ACHIEVEMENT_DEFS ‡∏ô‡πâ‡∏≠‡∏¢‡∏Å‡∏ß‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏Ñ‡∏≤‡∏î');
                await T('sec-achieve', 'sec-achieve-body', 'kao_awakened definition',
                    () => !!(window.ACHIEVEMENT_DEFS?.find(a => a.id === 'kao_awakened')),
                    'Failed: kao_awakened ‡πÑ‡∏°‡πà‡∏û‡∏ö‡πÉ‡∏ô ACHIEVEMENT_DEFS ‚Äî check config.js');
                await T('sec-achieve', 'sec-achieve-body', 'barrel_bomber definition',
                    () => !!(window.ACHIEVEMENT_DEFS?.find(a => a.id === 'barrel_bomber')),
                    'Failed: barrel_bomber ‡πÑ‡∏°‡πà‡∏û‡∏ö‡πÉ‡∏ô ACHIEVEMENT_DEFS ‚Äî check config.js');
                await T('sec-achieve', 'sec-achieve-body', 'ritual_wipe definition',
                    () => !!(window.ACHIEVEMENT_DEFS?.find(a => a.id === 'ritual_wipe')),
                    'Failed: ritual_wipe ‡πÑ‡∏°‡πà‡∏û‡∏ö‡πÉ‡∏ô ACHIEVEMENT_DEFS ‚Äî check config.js');
                await delay(50);

                // ‚îÄ‚îÄ 8. VERSION & SERVICE WORKER ‚îÄ‚îÄ
                diag.sep('8. VERSION & SERVICE WORKER');

                await T('sec-version', 'sec-version-body', 'VersionManager class',
                    () => isDefined('window.VersionManager') && typeof window.VersionManager.updateMenuVersion === 'function',
                    'Failed: VersionManager ‡πÑ‡∏°‡πà‡∏û‡∏ö ‚Äî check js/VersionManager.js');
                await T('sec-version', 'sec-version-body', 'ServiceWorker supported',
                    () => 'serviceWorker' in navigator || 'warn',
                    'WARN: ServiceWorker ‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡πÉ‡∏ô browser ‡∏ô‡∏µ‡πâ');
                // file:// protocol ‚Üí SW ‡πÑ‡∏°‡πà‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ï‡∏≤‡∏°‡∏ò‡∏£‡∏£‡∏°‡∏ä‡∏≤‡∏ï‡∏¥ ‡∏ñ‡∏∑‡∏≠‡∏ß‡πà‡∏≤ N/A = pass
                const _fileProto = location.protocol === 'file:';

                await T('sec-version', 'sec-version-body', 'ServiceWorker registered',
                    async () => {
                        if (_fileProto) { diag.log('  - SW check ‡∏Ç‡πâ‡∏≤‡∏°: ‡πÄ‡∏õ‡∏¥‡∏î‡∏à‡∏≤‡∏Å file:// (N/A ‚Äî ‡∏õ‡∏Å‡∏ï‡∏¥)', 'system'); return true; }
                        if (!('serviceWorker' in navigator)) return 'warn';
                        try {
                            const reg = await navigator.serviceWorker.getRegistration('./');
                            if (!reg) { diag.log('  ! SW ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ register ‚Äî ‡πÄ‡∏õ‡∏¥‡∏î‡∏à‡∏≤‡∏Å index.html ‡∏Å‡πà‡∏≠‡∏ô', 'warn'); return 'warn'; }
                            diag.log(`  ok SW registered: scope=${reg.scope}`, 'success');
                            return true;
                        } catch (e) { return false; }
                    },
                    'WARN: SW ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ register ‚Äî ‡πÄ‡∏õ‡∏¥‡∏î‡∏à‡∏≤‡∏Å index.html ‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ SW ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á');

                await T('sec-version', 'sec-version-body', 'GAME_VERSION accessible',
                    () => {
                        if (_fileProto) { diag.log('  - GAME_VERSION check ‡∏Ç‡πâ‡∏≤‡∏°: ‡πÄ‡∏õ‡∏¥‡∏î‡∏à‡∏≤‡∏Å file:// (N/A ‚Äî ‡∏õ‡∏Å‡∏ï‡∏¥)', 'system'); return true; }
                        const v = window.GAME_VERSION;
                        if (v && v !== 'unknown') { diag.log(`  ok GAME_VERSION = ${v}`, 'success'); return true; }
                        diag.log('  ! GAME_VERSION ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏° (SW ‡∏≠‡∏≤‡∏à‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏™‡πà‡∏á postMessage)', 'warn');
                        return 'warn';
                    },
                    'WARN: GAME_VERSION ‡πÑ‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏° ‚Äî SW ‡∏ï‡πâ‡∏≠‡∏á‡∏™‡πà‡∏á postMessage ‡∏Å‡πà‡∏≠‡∏ô');

                // ‚îÄ‚îÄ WRAP UP ‚îÄ‚îÄ
                diag.sep('COMPLETE');
                const total = state.results.length;
                const passed = state.results.filter(r => r.status === 'pass').length;
                const failed = state.results.filter(r => r.status === 'fail').length;
                const warned = state.results.filter(r => r.status === 'warn').length;

                diag.log(`Diagnostic complete: ${passed}/${total} passed ¬∑ ${failed} failed ¬∑ ${warned} warnings`,
                    failed > 0 ? 'error' : warned > 0 ? 'warn' : 'success');

                if (failed === 0 && warned === 0) {
                    diag.log('‚úî All systems operational.', 'success');
                    setStatus(`ALL SYSTEMS GO ‚Äî ${passed}/${total} checks passed.`, true);
                } else if (failed > 0) {
                    diag.log(`‚úñ ${failed} system(s) failed.`, 'error');
                    setStatus(`ISSUES DETECTED ‚Äî ${failed} failure(s), ${warned} warning(s).`, true);
                } else {
                    diag.log(`‚ö† ${warned} warning(s) detected.`, 'warn');
                    setStatus(`WARNINGS ‚Äî ${warned} warning(s). Most systems OK.`, true);
                }

                // Update quick stats scripts count
                const scriptModules = ['BALANCE', 'mapSystem', 'UIManager', 'Achievements', 'toggleSlowMotion', 'startNextWave', 'KaoPlayer', 'AutoPlayer', 'PoomPlayer', 'Enemy', 'Boss', 'GameState', 'VersionManager'];
                const loaded = scriptModules.filter(k => typeof window[k] !== 'undefined').length;
                document.getElementById('qs-scripts').textContent = `${loaded}/${scriptModules.length}`;
                document.getElementById('qs-scripts').className = `qs-value ${loaded === scriptModules.length ? 'ok' : loaded >= scriptModules.length * 0.8 ? 'warn' : 'err'}`;

                state.running = false;
                document.getElementById('run-btn').disabled = false;

                // Auto-refresh inspector tabs
                renderAchievements();
                renderBalanceSections();
                renderChars();
                renderGameState();
            };

            // ‚îÄ‚îÄ Auto-init on load ‚îÄ‚îÄ
            window.addEventListener('load', () => {
                // Quick stats initial values
                renderAchievements();
                renderBalanceSections();
                renderChars();

                const v = window.GAME_VERSION;
                if (v && v !== 'unknown') {
                    document.getElementById('qs-version').textContent = `v${v}`;
                    document.getElementById('qs-version').className = 'qs-value ok';
                }

                setTimeout(runAllDiagnostics, 700);
            });

        })();
    </script>

</body>

</html>