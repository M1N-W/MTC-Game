<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MTC the Game Beta Edition â€” System Diagnostics v2.1</title>

    <!--
    â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
    â•‘          MTC the Game Beta Edition â€” DEBUG.HTML v2.1         â•‘
    â•‘â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•‘
    â•‘  INSTRUCTIONS: Place this file in your project ROOT.        â•‘
    â•‘  Then add your game <script> tags in the section below      â•‘
    â•‘  marked "INJECT YOUR GAME SCRIPTS HERE".                    â•‘
    â•‘  Scripts must be loaded in dependency order.                â•‘
    â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    -->

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&family=Orbitron:wght@400;700;900&display=swap" rel="stylesheet">

    <style>
        /* â”€â”€ CSS Variables â”€â”€ */
        :root {
            --bg-dark:      #030712;
            --bg-panel:     #0a0f1e;
            --bg-card:      #0d1526;
            --border:       #1a2744;
            --border-glow:  #1e3a6e;
            --text:         #8da9c4;
            --text-bright:  #c8ddf4;
            --primary:      #2563eb;
            --primary-glow: rgba(37, 99, 235, 0.3);
            --success:      #10b981;
            --success-bg:   rgba(16, 185, 129, 0.1);
            --danger:       #ef4444;
            --danger-bg:    rgba(239, 68, 68, 0.1);
            --warning:      #f59e0b;
            --warning-bg:   rgba(245, 158, 11, 0.1);
            --accent:       #06b6d4;
            --accent2:      #7c3aed;
            --pending:      #334155;
            --font-mono:    'Share Tech Mono', 'Courier New', monospace;
            --font-display: 'Orbitron', sans-serif;
        }

        /* â”€â”€ Reset & Base â”€â”€ */
        *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            background: var(--bg-dark);
            color: var(--text);
            font-family: var(--font-mono);
            font-size: 13px;
            line-height: 1.6;
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* â”€â”€ Scanline overlay â”€â”€ */
        body::before {
            content: '';
            position: fixed; inset: 0;
            background: repeating-linear-gradient(
                0deg,
                transparent,
                transparent 2px,
                rgba(0, 0, 0, 0.07) 2px,
                rgba(0, 0, 0, 0.07) 4px
            );
            pointer-events: none;
            z-index: 9999;
        }

        /* â”€â”€ Corner decoration â”€â”€ */
        .corner { position: absolute; width: 16px; height: 16px; }
        .corner-tl { top: 0; left: 0; border-top: 2px solid var(--accent); border-left: 2px solid var(--accent); }
        .corner-tr { top: 0; right: 0; border-top: 2px solid var(--accent); border-right: 2px solid var(--accent); }
        .corner-bl { bottom: 0; left: 0; border-bottom: 2px solid var(--accent); border-left: 2px solid var(--accent); }
        .corner-br { bottom: 0; right: 0; border-bottom: 2px solid var(--accent); border-right: 2px solid var(--accent); }

        /* â”€â”€ Wrapper â”€â”€ */
        #app {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* â”€â”€ Header â”€â”€ */
        .header {
            position: relative;
            padding: 30px 0 24px;
            margin-bottom: 24px;
            border-bottom: 1px solid var(--border);
        }

        .header::after {
            content: '';
            position: absolute;
            bottom: -1px; left: 0;
            width: 200px; height: 2px;
            background: linear-gradient(90deg, var(--accent), transparent);
        }

        .header-top {
            display: flex;
            align-items: flex-start;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 16px;
        }

        .title-block {}

        .title-eyebrow {
            font-family: var(--font-mono);
            font-size: 10px;
            letter-spacing: 4px;
            color: var(--accent);
            text-transform: uppercase;
            margin-bottom: 6px;
        }

        .title-main {
            font-family: var(--font-display);
            font-size: clamp(18px, 3vw, 30px);
            font-weight: 900;
            color: var(--text-bright);
            letter-spacing: 2px;
            text-transform: uppercase;
            line-height: 1;
        }

        .title-main span { color: var(--accent); }

        .title-sub {
            font-family: var(--font-mono);
            font-size: 11px;
            color: var(--text);
            margin-top: 8px;
            letter-spacing: 1px;
        }

        /* â”€â”€ Buttons â”€â”€ */
        .btn-group { display: flex; gap: 10px; align-items: center; flex-wrap: wrap; }

        .btn {
            font-family: var(--font-display);
            font-size: 10px;
            font-weight: 700;
            letter-spacing: 2px;
            text-transform: uppercase;
            padding: 10px 20px;
            border-radius: 3px;
            border: 1px solid transparent;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
            overflow: hidden;
        }

        .btn::after {
            content: '';
            position: absolute;
            top: 0; left: -100%;
            width: 100%; height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.08), transparent);
            transition: left 0.4s;
        }
        .btn:hover::after { left: 100%; }

        .btn-primary {
            background: var(--primary);
            border-color: #1d4ed8;
            color: white;
        }
        .btn-primary:hover { background: #1d4ed8; box-shadow: 0 0 20px var(--primary-glow); }

        .btn-run {
            background: transparent;
            border-color: var(--success);
            color: var(--success);
        }
        .btn-run:hover { background: var(--success-bg); box-shadow: 0 0 16px rgba(16,185,129,0.25); }
        .btn-run:disabled { opacity: 0.4; cursor: not-allowed; }
        .btn-run:disabled:hover { background: transparent; box-shadow: none; }

        .btn-clear {
            background: transparent;
            border-color: var(--border-glow);
            color: var(--text);
        }
        .btn-clear:hover { border-color: var(--text); color: var(--text-bright); }

        /* â”€â”€ Live clock â”€â”€ */
        .live-clock {
            font-family: var(--font-display);
            font-size: 11px;
            color: var(--accent);
            letter-spacing: 2px;
            padding: 8px 14px;
            border: 1px solid var(--border);
            border-radius: 3px;
            background: var(--bg-card);
        }

        /* â”€â”€ Progress bar â”€â”€ */
        .progress-bar-wrap {
            margin-bottom: 24px;
            padding: 16px 20px;
            background: var(--bg-panel);
            border: 1px solid var(--border);
            border-radius: 6px;
            position: relative;
        }

        .progress-bar-wrap .corner { position: absolute; }

        .progress-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .progress-label {
            font-family: var(--font-display);
            font-size: 10px;
            letter-spacing: 2px;
            text-transform: uppercase;
            color: var(--text);
        }

        .progress-stats {
            display: flex;
            gap: 20px;
            font-size: 11px;
        }

        .stat-pass  { color: var(--success); }
        .stat-fail  { color: var(--danger); }
        .stat-warn  { color: var(--warning); }
        .stat-total { color: var(--text-bright); }

        .progress-track {
            height: 6px;
            background: var(--border);
            border-radius: 3px;
            overflow: hidden;
            position: relative;
        }

        .progress-fill {
            height: 100%;
            width: 0%;
            border-radius: 3px;
            background: linear-gradient(90deg, var(--primary), var(--accent));
            transition: width 0.5s ease;
            position: relative;
        }

        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0; right: 0;
            width: 40px; height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.5));
            animation: shimmer 1.5s infinite;
        }

        @keyframes shimmer {
            0%   { opacity: 0; }
            50%  { opacity: 1; }
            100% { opacity: 0; }
        }

        .progress-pct {
            font-family: var(--font-display);
            font-size: 11px;
            color: var(--accent);
            font-weight: 700;
            letter-spacing: 1px;
        }

        /* â”€â”€ Sections Grid â”€â”€ */
        .sections-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(380px, 1fr));
            gap: 18px;
            margin-bottom: 24px;
        }

        /* â”€â”€ Section Card â”€â”€ */
        .section-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 6px;
            overflow: hidden;
            transition: border-color 0.3s;
        }

        .section-card:hover { border-color: var(--border-glow); }

        .section-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 14px 18px;
            background: var(--bg-panel);
            border-bottom: 1px solid var(--border);
            cursor: pointer;
            user-select: none;
            transition: background 0.2s;
        }

        .section-header:hover { background: #0f1a2e; }

        .section-title-wrap {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section-icon {
            width: 28px; height: 28px;
            border-radius: 4px;
            display: flex; align-items: center; justify-content: center;
            font-size: 14px;
            flex-shrink: 0;
        }

        .section-title {
            font-family: var(--font-display);
            font-size: 10px;
            letter-spacing: 2px;
            text-transform: uppercase;
            color: var(--text-bright);
            font-weight: 700;
        }

        .section-meta {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .mini-badge {
            font-size: 10px;
            padding: 2px 8px;
            border-radius: 10px;
            font-weight: bold;
            letter-spacing: 1px;
        }
        .mini-badge.pass  { background: var(--success-bg);  color: var(--success);  border: 1px solid rgba(16,185,129,0.3); }
        .mini-badge.fail  { background: var(--danger-bg);   color: var(--danger);   border: 1px solid rgba(239,68,68,0.3); }
        .mini-badge.warn  { background: var(--warning-bg);  color: var(--warning);  border: 1px solid rgba(245,158,11,0.3); }
        .mini-badge.idle  { background: #1e293b;             color: #64748b;          border: 1px solid var(--border); }

        .collapse-arrow {
            color: var(--text);
            font-size: 12px;
            transition: transform 0.3s;
            line-height: 1;
        }

        .section-card.collapsed .collapse-arrow { transform: rotate(-90deg); }

        .section-body {
            padding: 0;
            overflow: hidden;
            transition: max-height 0.35s ease;
            max-height: 2000px;
        }

        .section-card.collapsed .section-body { max-height: 0; }

        /* â”€â”€ Test Item â”€â”€ */
        .test-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 9px 18px;
            border-bottom: 1px solid rgba(26, 39, 68, 0.6);
            gap: 12px;
            transition: background 0.15s;
            cursor: default;
        }

        .test-item:last-child { border-bottom: none; }
        .test-item:hover { background: rgba(255,255,255,0.02); }

        .test-left {
            display: flex;
            align-items: center;
            gap: 10px;
            min-width: 0;
        }

        .test-indicator {
            width: 6px; height: 6px;
            border-radius: 50%;
            flex-shrink: 0;
        }

        .test-indicator.pass { background: var(--success); box-shadow: 0 0 6px var(--success); }
        .test-indicator.fail { background: var(--danger);  box-shadow: 0 0 6px var(--danger); }
        .test-indicator.warn { background: var(--warning); box-shadow: 0 0 6px var(--warning); }
        .test-indicator.idle { background: #334155; }
        .test-indicator.running { background: var(--accent); animation: pulse 0.8s infinite; }

        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.4; transform: scale(0.6); }
        }

        .test-name {
            color: var(--text);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            font-size: 12px;
        }

        .test-right {
            display: flex;
            align-items: center;
            gap: 8px;
            flex-shrink: 0;
        }

        .status-badge {
            font-family: var(--font-display);
            font-size: 9px;
            font-weight: 700;
            letter-spacing: 1.5px;
            padding: 3px 10px;
            border-radius: 2px;
            text-transform: uppercase;
        }

        .status-badge.pass { background: var(--success-bg);  color: var(--success);  border: 1px solid rgba(16,185,129,0.4); }
        .status-badge.fail { background: var(--danger-bg);   color: var(--danger);   border: 1px solid rgba(239,68,68,0.4); }
        .status-badge.warn { background: var(--warning-bg);  color: var(--warning);  border: 1px solid rgba(245,158,11,0.4); }
        .status-badge.idle { background: #1e293b;              color: #475569;          border: 1px solid var(--border); }
        .status-badge.running { background: rgba(6,182,212,0.1); color: var(--accent); border: 1px solid rgba(6,182,212,0.3); }

        /* tooltip on hover */
        .test-item[data-tip]:hover::after {
            content: attr(data-tip);
            position: fixed;
            bottom: 20px; left: 50%;
            transform: translateX(-50%);
            background: #0f172a;
            border: 1px solid var(--border-glow);
            color: var(--text-bright);
            padding: 6px 14px;
            border-radius: 4px;
            font-size: 11px;
            white-space: nowrap;
            z-index: 1000;
            pointer-events: none;
            max-width: 500px;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        /* â”€â”€ Section Icon colours â”€â”€ */
        .ic-engine  { background: rgba(37, 99, 235, 0.15);  color: #60a5fa; }
        .ic-system  { background: rgba(6, 182, 212, 0.15);  color: var(--accent); }
        .ic-entity  { background: rgba(124, 58, 237, 0.15); color: #a78bfa; }
        .ic-content { background: rgba(245, 158, 11, 0.15); color: var(--warning); }
        .ic-api     { background: rgba(239, 68, 68, 0.15);  color: #f87171; }

        /* â”€â”€ Console â”€â”€ */
        .console-wrap {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 6px;
            overflow: hidden;
            margin-bottom: 20px;
        }

        .console-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px 18px;
            background: var(--bg-panel);
            border-bottom: 1px solid var(--border);
        }

        .console-title {
            font-family: var(--font-display);
            font-size: 10px;
            letter-spacing: 2px;
            color: var(--text);
            text-transform: uppercase;
        }

        .console-dots { display: flex; gap: 6px; }
        .console-dot {
            width: 10px; height: 10px; border-radius: 50%;
        }
        .dot-red    { background: #ef4444; }
        .dot-yellow { background: #f59e0b; }
        .dot-green  { background: #10b981; }

        #console-output {
            padding: 14px 18px;
            height: 220px;
            overflow-y: auto;
            font-size: 11.5px;
            line-height: 1.8;
            background: #000;
        }

        #console-output::-webkit-scrollbar { width: 4px; }
        #console-output::-webkit-scrollbar-thumb { background: var(--border-glow); border-radius: 2px; }

        .log-info    { color: #60a5fa; }
        .log-success { color: #34d399; }
        .log-error   { color: #f87171; }
        .log-warn    { color: #fbbf24; }
        .log-system  { color: #94a3b8; }

        .log-prompt { color: #475569; margin-right: 6px; }

        /* â”€â”€ Footer â”€â”€ */
        .footer {
            text-align: center;
            padding: 16px 0;
            font-size: 10px;
            letter-spacing: 2px;
            color: #334155;
            border-top: 1px solid var(--border);
            text-transform: uppercase;
        }

        /* â”€â”€ Status bar â”€â”€ */
        .status-bar {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 6px 0;
            margin-bottom: 20px;
            font-size: 10px;
            color: #475569;
            letter-spacing: 2px;
        }

        .status-bar-dot { width: 6px; height: 6px; border-radius: 50%; background: var(--success); box-shadow: 0 0 6px var(--success); }
        .status-bar-dot.inactive { background: #334155; box-shadow: none; }

        /* Blinking cursor */
        .blink { animation: blink 1s step-end infinite; }
        @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0; } }

        /* Running state shimmer on section */
        .section-card.running { border-color: rgba(6, 182, 212, 0.4); }

        /* Hidden game canvas */
        #gameCanvas { display: none; }
    </style>
</head>
<body>

<!--
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘              DUMMY DOM â€” "Ghost of index.html"                  â•‘
â•‘  Every ID/element that ui.js, game.js, shop.js etc. look for   â•‘
â•‘  is replicated here inside a hidden wrapper so the scripts      â•‘
â•‘  never throw "Cannot set property of null" errors.             â•‘
â•‘  This wrapper is completely invisible to the user.              â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-->
<div id="__dummy-dom__" style="display:none !important; position:absolute; pointer-events:none; visibility:hidden; width:0; height:0; overflow:hidden;" aria-hidden="true">

    <!-- â”€â”€ Canvas (also kept real above for 2D context tests) â”€â”€ -->
    <canvas id="gameCanvas" width="800" height="600"></canvas>

    <!-- â”€â”€ Boss / Voice UI â”€â”€ -->
    <div id="boss-speech"></div>
    <div id="voice-bubble"></div>
    <div id="achievements"></div>

    <!-- â”€â”€ Proximity prompts â”€â”€ -->
    <div id="db-prompt"></div>
    <div id="console-prompt"></div>
    <div id="shop-prompt"></div>

    <!-- â”€â”€ Pause â”€â”€ -->
    <div id="pause-indicator"></div>
    <div id="resume-prompt"><button onclick=""></button></div>

    <!-- â”€â”€ Admin Console â”€â”€ -->
    <div id="admin-console">
        <div class="console-inner" id="console-inner">
            <div id="console-output"></div>
            <input type="text" id="console-input" />
        </div>
    </div>

    <!-- â”€â”€ Shop Modal â”€â”€ -->
    <div id="shop-modal">
        <div class="shop-inner">
            <span id="shop-score-display">0</span>
            <div id="shop-items"></div>
        </div>
    </div>

    <!-- â”€â”€ Weapon indicator â”€â”€ -->
    <div class="weapon-indicator">
        <div id="weapon-name">AUTO RIFLE</div>
    </div>

    <!-- â”€â”€ HUD Layer (all bar/stat IDs) â”€â”€ -->
    <div id="ui-layer">
        <div class="hud-top">
            <div class="player-card">
                <div id="player-avatar">ğŸ‘¨ğŸ»â€ğŸ“</div>
                <div class="status-bars">
                    <div class="bar-wrap"><div id="hp-bar" class="bar-fill hp-fill" style="width:100%"></div></div>
                    <div class="bar-wrap"><div id="en-bar" class="bar-fill en-fill" style="width:100%"></div></div>
                    <div class="level-info">
                        <div class="level-display">
                            <span id="player-level">Lv.1</span>
                            <div class="exp-bar-bg"><div id="exp-bar"></div></div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="stats-box">
                <div id="score">0</div>
                <div id="wave-badge">WAVE 1</div>
            </div>
        </div>

        <!-- Boss HUD -->
        <div id="boss-hud">
            <div id="boss-name">BOSS</div>
            <div class="boss-hp-bg">
                <div id="boss-hp-bar" class="boss-hp-fill"></div>
            </div>
        </div>

        <!-- Skill icons -->
        <div class="hud-bottom">
            <div class="skill-icon" id="dash-icon">
                <div class="cooldown-mask" id="dash-cd"></div>
            </div>
            <div class="skill-icon" id="stealth-icon">
                <span id="skill1-hint">R-Click</span>
                <span id="skill1-emoji">ğŸ“–</span>
                <div class="cooldown-mask" id="stealth-cd"></div>
            </div>
            <div class="skill-icon" id="naga-icon">
                <div class="cooldown-mask" id="naga-cd"></div>
                <span id="naga-timer"></span>
            </div>
            <div class="skill-icon" id="passive-skill">
                <div class="skill-name">à¸‹à¸¸à¹ˆà¸¡à¹€à¸ªà¸£à¸µ</div>
            </div>
            <div class="skill-icon" id="db-hud-icon"></div>
            <div class="skill-icon" id="console-hud-icon"></div>
            <div class="skill-icon" id="shop-hud-icon"></div>
        </div>
    </div>

    <!-- â”€â”€ Main Menu Overlay â”€â”€ -->
    <div id="overlay">
        <div class="menu-container">
            <div id="mission-brief"></div>
            <div id="report-card">
                <div class="report-stats">
                    <div class="stat-item"><div id="report-score">0</div></div>
                    <div class="stat-item"><div id="report-wave">0</div></div>
                    <div class="stat-item"><div id="report-kills">0</div></div>
                </div>
                <div id="report-text"></div>
            </div>
            <button id="start-btn">START MISSION</button>
            <div id="ai-loading"></div>
        </div>
    </div>

    <!-- â”€â”€ Victory Screen â”€â”€ -->
    <div id="victory-screen">
        <div id="final-score">0</div>
        <div id="final-wave">0</div>
        <div id="final-kills">0</div>
    </div>

    <!-- â”€â”€ Tutorial Overlay â”€â”€ -->
    <div id="tutorial-overlay">
        <div class="tutorial-card" id="tutorial-card">
            <div id="tut-icon">ğŸ“</div>
            <div id="tut-title"></div>
            <div id="tut-body"></div>
            <div id="tut-action-hint"></div>
            <div id="tut-action-bar"><div id="tut-action-fill"></div></div>
            <div id="tut-action-label"></div>
            <div id="tutorial-progress"></div>
            <button id="tut-next-btn">NEXT</button>
            <button id="tut-skip-btn">SKIP</button>
        </div>
    </div>

    <!-- â”€â”€ Mobile UI â”€â”€ -->
    <div id="mobile-ui">
        <div id="joystick-left-zone" class="joystick-zone left">
            <div id="joystick-left-base" class="joystick-base">
                <div id="joystick-left-stick" class="joystick-stick"></div>
            </div>
        </div>
        <div id="joystick-right-zone" class="joystick-zone right">
            <div id="joystick-right-base" class="joystick-base">
                <div id="joystick-right-stick" class="joystick-stick"></div>
            </div>
        </div>
        <button id="btn-switch"   class="action-btn">ğŸ”„</button>
        <button id="btn-skill"    class="action-btn">ğŸ“–</button>
        <button id="btn-dash"     class="action-btn">ğŸ’¨</button>
        <button id="btn-naga"     class="action-btn">ğŸ‰</button>
        <button id="btn-database" class="action-btn">ğŸ“š</button>
        <button id="btn-terminal" class="action-btn">ğŸ’»</button>
        <button id="btn-shop"     class="action-btn">ğŸ›’</button>
    </div>

    <!-- â”€â”€ Character selection cards (game.js may query these) â”€â”€ -->
    <div id="card-kao"  class="char-card selected" data-char="kao"></div>
    <div id="card-poom" class="char-card" data-char="poom"></div>
    <div id="btn-auto"  class="char-card" data-char="auto"></div>

</div>

<!-- Real canvas for 2D context tests (outside hidden wrapper) -->
<canvas id="__real_canvas__" width="800" height="600" style="display:none"></canvas>

<!--
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘              GAME SCRIPTS â€” mirrored from index.html            â•‘
â•‘  Loaded in the same dependency order as the main game.          â•‘
â•‘  ai.js is commented out here (matching index.html).             â•‘
â•‘  The diagnostic will mark it WARN rather than crashing.         â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-->

<!-- Content & Config (no dependencies) -->
<script src="js/secrets.js"></script>
<script src="js/config.js"></script>
<script src="js/utils.js"></script>

<!-- Standalone systems -->
<script src="js/audio.js"></script>
<script src="js/effects.js"></script>
<script src="js/weapons.js"></script>
<script src="js/map.js"></script>
<script src="js/ui.js"></script>
<script src="js/tutorial.js"></script>

<!-- AI integration (commented out â€” matches index.html) -->
<!-- <script src="js/ai.js"></script> -->

<!-- Entities: base first, then subclasses -->
<script src="js/entities/base.js"></script>
<script src="js/entities/player/PlayerBase.js"></script>
<script src="js/entities/player/AutoPlayer.js"></script>
<script src="js/entities/player/PoomPlayer.js"></script>
<script src="js/entities/summons.js"></script>
<script src="js/entities/enemy.js"></script>
<script src="js/entities/boss_attacks.js"></script>
<script src="js/entities/boss.js"></script>

<!-- Input (depends on canvas/DOM being ready) -->
<script src="js/input.js"></script>

<!-- Extracted systems (depend on config + entities) -->
<script src="js/systems/AdminSystem.js"></script>
<script src="js/systems/ShopSystem.js"></script>
<script src="js/systems/TimeManager.js"></script>
<script src="js/systems/WaveManager.js"></script>

<!-- Game core â€” MUST be last -->
<script src="js/game.js"></script>


<div id="app">

    <!-- â”€â”€ Header â”€â”€ -->
    <header class="header">
        <div class="header-top">
            <div class="title-block">
                <div class="title-eyebrow">â¬¡ System Diagnostics v2.1</div>
                <div class="title-main">MTC: <span>Beta</span> Edition</div>
                <div class="title-sub">Diagnostic Console Â· All Systems Check Â· Runtime Analysis</div>
            </div>
            <div class="btn-group">
                <div class="live-clock" id="live-clock">--:--:--</div>
                <button class="btn btn-clear" onclick="clearAll()">âŸ³ Clear</button>
                <button class="btn btn-run" id="run-btn" onclick="runAllDiagnostics()">â–¶ Run Diagnostics</button>
            </div>
        </div>
    </header>

    <!-- â”€â”€ Status bar â”€â”€ -->
    <div class="status-bar">
        <div class="status-bar-dot" id="status-dot"></div>
        <span id="status-text">READY â€” Press "Run Diagnostics" to begin</span>
        <span class="blink">_</span>
    </div>

    <!-- â”€â”€ Progress bar â”€â”€ -->
    <div class="progress-bar-wrap">
        <div class="corner corner-tl"></div>
        <div class="corner corner-tr"></div>
        <div class="corner corner-bl"></div>
        <div class="corner corner-br"></div>
        <div class="progress-header">
            <span class="progress-label">Overall Diagnostic Completion</span>
            <div class="progress-stats">
                <span class="stat-pass" id="stat-pass">PASS: 0</span>
                <span class="stat-fail" id="stat-fail">FAIL: 0</span>
                <span class="stat-warn" id="stat-warn">WARN: 0</span>
                <span class="stat-total" id="stat-total">TOTAL: 0</span>
            </div>
        </div>
        <div class="progress-track">
            <div class="progress-fill" id="progress-fill"></div>
        </div>
        <div style="display:flex; justify-content:space-between; margin-top:6px;">
            <span style="font-size:10px;color:#334155;">0%</span>
            <span class="progress-pct" id="progress-pct">0%</span>
            <span style="font-size:10px;color:#334155;">100%</span>
        </div>
    </div>

    <!-- â”€â”€ Test Sections Grid â”€â”€ -->
    <div class="sections-grid" id="sections-grid">

        <!-- â”€â”€â”€ CORE ENGINE â”€â”€â”€ -->
        <div class="section-card" id="sec-core">
            <div class="section-header" onclick="toggleSection('sec-core')">
                <div class="section-title-wrap">
                    <div class="section-icon ic-engine">âš™ï¸</div>
                    <div>
                        <div class="section-title">Core Engine</div>
                        <div style="font-size:10px;color:#475569;margin-top:1px;">config Â· utils Â· map Â· ui Â· input</div>
                    </div>
                </div>
                <div class="section-meta">
                    <span class="mini-badge idle" id="sec-core-badge">IDLE</span>
                    <span class="collapse-arrow">â–¾</span>
                </div>
            </div>
            <div class="section-body" id="sec-core-body"></div>
        </div>

        <!-- â”€â”€â”€ GAME SYSTEMS â”€â”€â”€ -->
        <div class="section-card" id="sec-systems">
            <div class="section-header" onclick="toggleSection('sec-systems')">
                <div class="section-title-wrap">
                    <div class="section-icon ic-system">ğŸ”§</div>
                    <div>
                        <div class="section-title">Game Systems</div>
                        <div style="font-size:10px;color:#475569;margin-top:1px;">TimeManager Â· WaveManager Â· Shop Â· Admin</div>
                    </div>
                </div>
                <div class="section-meta">
                    <span class="mini-badge idle" id="sec-systems-badge">IDLE</span>
                    <span class="collapse-arrow">â–¾</span>
                </div>
            </div>
            <div class="section-body" id="sec-systems-body"></div>
        </div>

        <!-- â”€â”€â”€ ENTITIES & PLAYERS â”€â”€â”€ -->
        <div class="section-card" id="sec-entities">
            <div class="section-header" onclick="toggleSection('sec-entities')">
                <div class="section-title-wrap">
                    <div class="section-icon ic-entity">ğŸ®</div>
                    <div>
                        <div class="section-title">Entities &amp; Players</div>
                        <div style="font-size:10px;color:#475569;margin-top:1px;">base Â· enemy Â· boss Â· summons Â· player variants</div>
                    </div>
                </div>
                <div class="section-meta">
                    <span class="mini-badge idle" id="sec-entities-badge">IDLE</span>
                    <span class="collapse-arrow">â–¾</span>
                </div>
            </div>
            <div class="section-body" id="sec-entities-body"></div>
        </div>

        <!-- â”€â”€â”€ AUDIO & EFFECTS â”€â”€â”€ -->
        <div class="section-card" id="sec-content">
            <div class="section-header" onclick="toggleSection('sec-content')">
                <div class="section-title-wrap">
                    <div class="section-icon ic-content">ğŸµ</div>
                    <div>
                        <div class="section-title">Audio &amp; Content</div>
                        <div style="font-size:10px;color:#475569;margin-top:1px;">audio Â· effects Â· weapons Â· tutorial Â· secrets</div>
                    </div>
                </div>
                <div class="section-meta">
                    <span class="mini-badge idle" id="sec-content-badge">IDLE</span>
                    <span class="collapse-arrow">â–¾</span>
                </div>
            </div>
            <div class="section-body" id="sec-content-body"></div>
        </div>

        <!-- â”€â”€â”€ EXTERNAL APIS â”€â”€â”€ -->
        <div class="section-card" id="sec-api">
            <div class="section-header" onclick="toggleSection('sec-api')">
                <div class="section-title-wrap">
                    <div class="section-icon ic-api">ğŸ¤–</div>
                    <div>
                        <div class="section-title">External &amp; AI</div>
                        <div style="font-size:10px;color:#475569;margin-top:1px;">Gemini API Â· Save system Â· localStorage</div>
                    </div>
                </div>
                <div class="section-meta">
                    <span class="mini-badge idle" id="sec-api-badge">IDLE</span>
                    <span class="collapse-arrow">â–¾</span>
                </div>
            </div>
            <div class="section-body" id="sec-api-body"></div>
        </div>

        <!-- â”€â”€â”€ GAME.JS INTEGRATION â”€â”€â”€ -->
        <div class="section-card" id="sec-game">
            <div class="section-header" onclick="toggleSection('sec-game')">
                <div class="section-title-wrap">
                    <div class="section-icon ic-engine">ğŸ•¹ï¸</div>
                    <div>
                        <div class="section-title">Game Core (game.js)</div>
                        <div style="font-size:10px;color:#475569;margin-top:1px;">game loop Â· state Â· canvas Â· init functions</div>
                    </div>
                </div>
                <div class="section-meta">
                    <span class="mini-badge idle" id="sec-game-badge">IDLE</span>
                    <span class="collapse-arrow">â–¾</span>
                </div>
            </div>
            <div class="section-body" id="sec-game-body"></div>
        </div>

    </div>

    <!-- â”€â”€ Console Output â”€â”€ -->
    <div class="console-wrap">
        <div class="console-header">
            <div class="console-dots">
                <div class="console-dot dot-red"></div>
                <div class="console-dot dot-yellow"></div>
                <div class="console-dot dot-green"></div>
            </div>
            <span class="console-title">Diagnostic Console Output</span>
            <span style="font-size:10px;color:#334155;">stdout</span>
        </div>
        <div id="console-output">
            <span class="log-system"><span class="log-prompt">$</span> MTC Diagnostic System v2.1 ready.</span><br>
            <span class="log-system"><span class="log-prompt">$</span> Press "â–¶ Run Diagnostics" to begin system analysis...</span><br>
        </div>
    </div>

    <!-- â”€â”€ Footer â”€â”€ -->
    <div class="footer">
        MTC the Game Beta Edition Â· Diagnostic Tool v2.1 Â· Anthropic-Powered Interface
    </div>

</div>


<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<!--                    DIAGNOSTIC ENGINE                          -->
<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<script>
(function () {
    'use strict';

    // â”€â”€ Intercept game bootstrap to prevent the game loop from actually starting â”€â”€
    window.startGame   = () => diag.log('[Intercepted] startGame() called â€” blocked on debug page.', 'warn');
    window.loopRunning = true;  // Flag some engines check before starting RAF loop

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // STATE
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    const state = {
        running: false,
        results: [], // { sectionId, name, status, tip }
    };

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // LIVE CLOCK
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function tickClock() {
        const d = new Date();
        const pad = n => String(n).padStart(2, '0');
        document.getElementById('live-clock').textContent =
            `${pad(d.getHours())}:${pad(d.getMinutes())}:${pad(d.getSeconds())}`;
    }
    tickClock();
    setInterval(tickClock, 1000);

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // LOGGER
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    const diag = {
        log(msg, type = 'info') {
            const out = document.getElementById('console-output');
            const d = new Date();
            const pad = n => String(n).padStart(2, '0');
            const ts = `${pad(d.getHours())}:${pad(d.getMinutes())}:${pad(d.getSeconds())}`;
            out.innerHTML += `<div><span class="log-system">[${ts}]</span> <span class="log-${type}">${escHtml(msg)}</span></div>`;
            out.scrollTop = out.scrollHeight;
        },
        sep(label = '') {
            const out = document.getElementById('console-output');
            const bar = label
                ? `â”€â”€ ${label} ${'â”€'.repeat(Math.max(0, 52 - label.length))}`
                : 'â”€'.repeat(58);
            out.innerHTML += `<div style="color:#1e3a6e;margin:4px 0;">${bar}</div>`;
        }
    };

    function escHtml(str) {
        return String(str)
            .replace(/&/g, '&amp;')
            .replace(/</g, '&lt;')
            .replace(/>/g, '&gt;')
            .replace(/"/g, '&quot;');
    }

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // PROGRESS UPDATER
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function updateProgress() {
        const total   = state.results.length;
        const passed  = state.results.filter(r => r.status === 'pass').length;
        const failed  = state.results.filter(r => r.status === 'fail').length;
        const warned  = state.results.filter(r => r.status === 'warn').length;
        const done    = passed + failed + warned;
        const pct     = total ? Math.round((done / total) * 100) : 0;

        document.getElementById('progress-fill').style.width = pct + '%';
        document.getElementById('progress-pct').textContent  = pct + '%';
        document.getElementById('stat-pass').textContent  = `PASS: ${passed}`;
        document.getElementById('stat-fail').textContent  = `FAIL: ${failed}`;
        document.getElementById('stat-warn').textContent  = `WARN: ${warned}`;
        document.getElementById('stat-total').textContent = `TOTAL: ${done}/${total}`;
    }

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // SECTION COLLAPSE TOGGLE
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    window.toggleSection = function (id) {
        document.getElementById(id).classList.toggle('collapsed');
    };

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // RENDER A TEST ROW
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function renderTestRow(bodyId, name, status = 'idle', tip = '') {
        const body = document.getElementById(bodyId);
        const id = `test-${bodyId}-${name.replace(/\s+/g,'_')}`;

        let existing = document.getElementById(id);
        if (!existing) {
            existing = document.createElement('div');
            existing.className = 'test-item';
            existing.id = id;
            body.appendChild(existing);
        }

        const statusLabels = { pass: 'PASS', fail: 'FAIL', warn: 'WARN', idle: 'PENDING', running: 'RUNNING' };
        existing.setAttribute('data-tip', tip || '');
        existing.innerHTML = `
            <div class="test-left">
                <div class="test-indicator ${status}"></div>
                <span class="test-name">${escHtml(name)}</span>
            </div>
            <div class="test-right">
                <span class="status-badge ${status}">${statusLabels[status] || status.toUpperCase()}</span>
            </div>
        `;
        return existing;
    }

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // UPDATE SECTION SUMMARY BADGE
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function updateSectionBadge(sectionId) {
        const badge = document.getElementById(`${sectionId}-badge`);
        if (!badge) return;
        const sectionResults = state.results.filter(r => r.sectionId === sectionId);
        if (!sectionResults.length) { badge.className = 'mini-badge idle'; badge.textContent = 'IDLE'; return; }
        const anyFail = sectionResults.some(r => r.status === 'fail');
        const anyWarn = sectionResults.some(r => r.status === 'warn');
        const allPending = sectionResults.every(r => r.status === 'idle');
        if (anyFail)     { badge.className = 'mini-badge fail'; badge.textContent = 'ISSUES'; }
        else if (anyWarn){ badge.className = 'mini-badge warn'; badge.textContent = 'WARN'; }
        else if (allPending){ badge.className = 'mini-badge idle'; badge.textContent = 'IDLE'; }
        else             { badge.className = 'mini-badge pass'; badge.textContent = 'OK'; }
    }

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // CORE ASSERTION HELPERS
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    /**
     * Run a single test.
     * @param {string}   sectionId  - DOM section id (e.g. 'sec-core')
     * @param {string}   bodyId     - DOM body id    (e.g. 'sec-core-body')
     * @param {string}   name       - Display name
     * @param {Function} testFn     - Returns true/false/'warn'
     * @param {string}   [failTip]  - Message shown on failure tooltip
     */
    async function runTest(sectionId, bodyId, name, testFn, failTip = '') {
        // Register
        const record = { sectionId, name, status: 'running' };
        state.results.push(record);

        renderTestRow(bodyId, name, 'running');

        let status = 'fail';
        let tip    = failTip;
        try {
            const result = await testFn();
            if (result === true)   { status = 'pass'; tip = ''; }
            else if (result === 'warn') { status = 'warn'; tip = failTip; }
            else { status = 'fail'; }
        } catch (err) {
            status = 'fail';
            tip = `Exception: ${err.message}`;
            diag.log(`  âœ– Exception in "${name}": ${err.message}`, 'error');
        }

        record.status = status;
        renderTestRow(bodyId, name, status, tip);
        updateSectionBadge(sectionId);
        updateProgress();
        return status;
    }

    /**
     * Check if a global variable/property path is defined and passes an optional predicate.
     * @param {string}   path   - e.g. 'window.ShopManager' or 'window.Gemini.init'
     * @param {Function} [pred] - Optional extra condition fn(value) => bool
     * @returns {boolean}
     */
    function isDefined(path, pred = null) {
        try {
            const parts = path.replace(/^window\./, '').split('.');
            let obj = window;
            for (const p of parts) {
                if (obj == null || !(p in Object(obj))) return false;
                obj = obj[p];
            }
            if (obj === undefined || obj === null) return false;
            if (pred) return pred(obj);
            return true;
        } catch { return false; }
    }

    /**
     * Check that a global is a constructor (class / function).
     */
    function isClass(path) {
        return isDefined(path, v => typeof v === 'function');
    }

    /**
     * Check that a global is a plain object or class instance (not null/undefined).
     */
    function isObject(path) {
        return isDefined(path, v => typeof v === 'object');
    }

    /**
     * Check that a global is a function.
     */
    function isFunction(path) {
        return isDefined(path, v => typeof v === 'function');
    }

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // CLEAR
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    window.clearAll = function () {
        document.getElementById('console-output').innerHTML =
            `<span class="log-system"><span class="log-prompt">$</span> Console cleared. Ready.</span><br>`;
        document.querySelectorAll('.section-body').forEach(b => b.innerHTML = '');
        state.results = [];
        updateProgress();
        ['sec-core','sec-systems','sec-entities','sec-content','sec-api','sec-game']
            .forEach(id => {
                const badge = document.getElementById(`${id}-badge`);
                if (badge) { badge.className = 'mini-badge idle'; badge.textContent = 'IDLE'; }
            });
        setStatus('READY â€” Logs cleared. Press "Run Diagnostics" to begin.', false);
    };

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // STATUS BAR
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function setStatus(msg, active = true) {
        document.getElementById('status-text').textContent = msg;
        const dot = document.getElementById('status-dot');
        dot.classList.toggle('inactive', !active);
    }

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    //  MAIN DIAGNOSTIC RUNNER
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    window.runAllDiagnostics = async function () {
        if (state.running) return;
        state.running = true;

        clearAll();
        document.getElementById('run-btn').disabled = true;
        setStatus('RUNNING â€” Diagnostic sequence in progress...', true);

        // â”€â”€ Announce dummy DOM â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        diag.log('Dummy DOM active: all index.html element IDs are present as hidden stubs.', 'success');
        diag.log('Game scripts will NOT throw "Cannot set property of null" errors.', 'success');
        diag.sep();

        const T = (secId, bodyId, name, testFn, failTip) =>
            runTest(secId, bodyId, name, testFn, failTip);

        // Small delay helper for visual stagger
        const delay = ms => new Promise(r => setTimeout(r, ms));

        // â”€â”€ 1. CORE ENGINE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        diag.sep('CORE ENGINE â€” config.js Â· utils.js Â· map.js Â· ui.js Â· input.js');

        await T('sec-core', 'sec-core-body',
            'MAP_CONFIG defined',
            () => isDefined('window.MAP_CONFIG'),
            'Failed: window.MAP_CONFIG is undefined. Check if config.js is loaded and exports MAP_CONFIG.');

        await T('sec-core', 'sec-core-body',
            'GAME_TEXTS / BALANCE defined',
            () => isDefined('window.GAME_TEXTS') || isDefined('window.BALANCE'),
            'Failed: Neither window.GAME_TEXTS nor window.BALANCE found. Check config.js.');

        await T('sec-core', 'sec-core-body',
            'BALANCE stats object',
            () => isDefined('window.BALANCE'),
            'Failed: window.BALANCE is undefined. Check config.js â€” BALANCE must be a global.');

        await T('sec-core', 'sec-core-body',
            'getDeltaTime() utility',
            () => isFunction('window.getDeltaTime'),
            'Failed: window.getDeltaTime is not a function. Check utils.js.');

        await T('sec-core', 'sec-core-body',
            'clamp() / lerp() math utils',
            () => isFunction('window.clamp') || isFunction('window.lerp'),
            'Failed: Neither window.clamp nor window.lerp found. Check utils.js for utility exports.');

        await T('sec-core', 'sec-core-body',
            'mapSystem object',
            () => isObject('window.mapSystem'),
            'Failed: window.mapSystem is undefined. Check map.js.');

        await T('sec-core', 'sec-core-body',
            'mapSystem.drawTerrain() method',
            () => isDefined('window.mapSystem.drawTerrain', v => typeof v === 'function'),
            'Failed: window.mapSystem.drawTerrain is not a function. Check map.js for the drawTerrain export.');

        await T('sec-core', 'sec-core-body',
            'UIManager defined',
            () => isDefined('window.UIManager'),
            'Failed: window.UIManager is undefined. Check ui.js.');

        await T('sec-core', 'sec-core-body',
            'Input System (inputSystem or keys)',
            () => isObject('window.inputSystem') || isDefined('window.keys'),
            'Failed: No input system found. Check input.js â€” expected window.inputSystem or window.keys object.');

        await T('sec-core', 'sec-core-body',
            'getSaveData() function',
            () => isFunction('window.getSaveData'),
            'Failed: window.getSaveData is not a function. Check utils.js or game.js.');

        await delay(60);

        // â”€â”€ 2. GAME SYSTEMS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        diag.sep('GAME SYSTEMS â€” TimeManager Â· WaveManager Â· ShopSystem Â· AdminSystem');

        await T('sec-systems', 'sec-systems-body',
            'TimeManager functions loaded (_tickSlowMoEnergy)',
            () => isFunction('window._tickSlowMoEnergy') && isFunction('window.toggleSlowMotion'),
            'Failed: TimeManager functions not found. Check systems/TimeManager.js â€” expected _tickSlowMoEnergy and toggleSlowMotion on window.');

        await T('sec-systems', 'sec-systems-body',
            'triggerHitStop() function',
            () => isFunction('window.triggerHitStop'),
            'Failed: window.triggerHitStop is not a function. Check systems/TimeManager.js.');

        await T('sec-systems', 'sec-systems-body',
            'toggleSlowMotion() function (Bullet Time)',
            () => isFunction('window.toggleSlowMotion'),
            'Failed: window.toggleSlowMotion is not a function. Check systems/TimeManager.js.');

        await T('sec-systems', 'sec-systems-body',
            'WaveManager or startNextWave()',
            () => isObject('window.waveManager') || isClass('window.WaveManager') || isFunction('window.startNextWave'),
            'Failed: No wave system found. Check systems/WaveManager.js â€” expected waveManager, WaveManager, or startNextWave.');

        await T('sec-systems', 'sec-systems-body',
            'startNextWave() function',
            () => isFunction('window.startNextWave'),
            'Failed: window.startNextWave is not a function. Check systems/WaveManager.js.');

        await T('sec-systems', 'sec-systems-body',
            'ShopSystem / ShopManager defined',
            () => isObject('window.ShopSystem') || isObject('window.ShopManager') ||
                  isClass('window.ShopSystem')  || isClass('window.ShopManager'),
            'Failed: No shop system found. Check systems/ShopSystem.js â€” expected window.ShopSystem or window.ShopManager.');

        await T('sec-systems', 'sec-systems-body',
            'AdminSystem / AdminConsole defined',
            () => isObject('window.AdminSystem') || isObject('window.AdminConsole') ||
                  isClass('window.AdminSystem')  || isClass('window.AdminConsole'),
            'Failed: No admin system found. Check systems/AdminSystem.js â€” expected window.AdminSystem or window.AdminConsole.');

        await T('sec-systems', 'sec-systems-body',
            'TutorialSystem defined',
            () => isObject('window.TutorialSystem') || isClass('window.TutorialSystem'),
            'Failed: window.TutorialSystem is undefined. Check tutorial.js.');

        await delay(60);

        // â”€â”€ 3. ENTITIES & PLAYERS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        diag.sep('ENTITIES & PLAYERS');

        await T('sec-entities', 'sec-entities-body',
            'Base Entity class (Entity or EntityBase)',
            () => isClass('window.Entity') || isClass('window.EntityBase'),
            'Failed: No base entity class found. Check entities/base.js â€” expected window.Entity or window.EntityBase.');

        await T('sec-entities', 'sec-entities-body',
            'Player base class',
            () => isClass('window.Player') || isClass('window.PlayerBase'),
            'Failed: No player base class found. Check entities/player/PlayerBase.js.');

        await T('sec-entities', 'sec-entities-body',
            'AutoPlayer class',
            () => isClass('window.AutoPlayer'),
            'Failed: window.AutoPlayer is not a class/function. Check entities/player/AutoPlayer.js.');

        await T('sec-entities', 'sec-entities-body',
            'PoomPlayer class',
            () => isClass('window.PoomPlayer'),
            'Failed: window.PoomPlayer is not a class/function. Check entities/player/PoomPlayer.js.');

        await T('sec-entities', 'sec-entities-body',
            'Enemy classes (TankEnemy or EnemyBase)',
            () => isClass('window.TankEnemy') || isClass('window.Enemy') || isClass('window.EnemyBase'),
            'Failed: No enemy class found. Check entities/enemy.js â€” expected window.TankEnemy, Enemy, or EnemyBase.');

        await T('sec-entities', 'sec-entities-body',
            'MageEnemy or ranged enemy class',
            () => isClass('window.MageEnemy') || isClass('window.RangedEnemy') || isClass('window.ShooterEnemy'),
            'Failed: No ranged enemy class found. Check entities/enemy.js.');

        await T('sec-entities', 'sec-entities-body',
            'Boss class defined',
            () => isClass('window.Boss'),
            'Failed: window.Boss is not a class/function. Check entities/boss.js.');

        await T('sec-entities', 'sec-entities-body',
            'BossFirst class (Kru First)',
            () => isClass('window.BossFirst'),
            'Failed: window.BossFirst is not a class/function. Check entities/boss.js.');

        await T('sec-entities', 'sec-entities-body',
            'Summons system (NagaEntity / DroneEntity)',
            () => isClass('window.NagaEntity') || isClass('window.DroneEntity'),
            'Failed: No summon class found. Check entities/summons.js â€” expected NagaEntity or DroneEntity.');

        await T('sec-entities', 'sec-entities-body',
            'weaponSystem object',
            () => isObject('window.weaponSystem'),
            'Failed: window.weaponSystem is undefined. Check weapons.js.');

        await delay(60);

        // â”€â”€ 4. AUDIO & CONTENT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        diag.sep('AUDIO & CONTENT â€” audio.js Â· effects.js Â· weapons.js Â· tutorial.js Â· secrets.js');

        await T('sec-content', 'sec-content-body',
            'Audio system (Audio.init or audioSystem)',
            () => isFunction('window.Audio.init') || isObject('window.audioSystem'),
            'Failed: No audio system found. Check audio.js â€” expected window.Audio.init or window.audioSystem.');

        await T('sec-content', 'sec-content-body',
            'Audio.playSound() or equivalent',
            () => isFunction('window.Audio.playSound') || isFunction('window.audioSystem.play') ||
                  isFunction('window.playSound'),
            'Failed: No playSound function found in audio system. Check audio.js.');

        await T('sec-content', 'sec-content-body',
            'Effects system (particleSystem / floatingTextSystem)',
            () => isObject('window.particleSystem') || isObject('window.floatingTextSystem') ||
                  isFunction('window.spawnParticles'),
            'Failed: No effects system found. Check effects.js â€” expected particleSystem, floatingTextSystem, or spawnParticles.');

        await T('sec-content', 'sec-content-body',
            'PorkSandwich interactive entity',
            () => isClass('window.PorkSandwich'),
            'Failed: window.PorkSandwich is not a class/function. Check effects.js to ensure it is exported to window.');

        await T('sec-content', 'sec-content-body',
            'Particle update loop (particleSystem.update)',
            () => isDefined('window.particleSystem.update', v => typeof v === 'function'),
            'Failed: window.particleSystem.update is not a function. Check effects.js.');

        await T('sec-content', 'sec-content-body',
            'Weapon definitions loaded (weaponSystem)',
            () => isObject('window.weaponSystem'),
            'Failed: window.weaponSystem is undefined. Check weapons.js.');

        await T('sec-content', 'sec-content-body',
            'weaponSystem.shoot() method',
            () => isDefined('window.weaponSystem.shoot', v => typeof v === 'function'),
            'Failed: window.weaponSystem.shoot is not a function. Check weapons.js.');

        await T('sec-content', 'sec-content-body',
            'Tutorial system (TutorialSystem)',
            () => isObject('window.TutorialSystem') || isClass('window.TutorialSystem'),
            'Failed: window.TutorialSystem is undefined. Check tutorial.js.');

        await T('sec-content', 'sec-content-body',
            'TutorialSystem.handleAction() method',
            () => isDefined('window.TutorialSystem.handleAction', v => typeof v === 'function'),
            'Failed: window.TutorialSystem.handleAction is not a function. Check tutorial.js.');

        await T('sec-content', 'sec-content-body',
            'CONFIG_SECRETS defined (secrets.js)',
            () => isObject('window.CONFIG_SECRETS'),
            'Failed: window.CONFIG_SECRETS is undefined. Check secrets.js â€” must export CONFIG_SECRETS object.');

        await delay(60);

        // â”€â”€ 5. EXTERNAL & AI â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        // NOTE: ai.js is commented out in index.html â€” all AI checks return WARN (expected, not a bug).
        diag.sep('EXTERNAL & AI â€” ai.js commented out in index.html');
        diag.log('  i ai.js is commented out in index.html â€” AI tests will show WARN (this is expected).', 'warn');

        await T('sec-api', 'sec-api-body',
            'Gemini object defined (ai.js)',
            () => {
                if (!isDefined('window.Gemini')) {
                    diag.log('  ! window.Gemini not found â€” ai.js is commented out. Expected.', 'warn');
                    return 'warn';
                }
                return true;
            },
            'WARN: window.Gemini undefined â€” ai.js is commented out in index.html. Uncomment to enable AI features.');

        await T('sec-api', 'sec-api-body',
            'Gemini.init() method',
            () => {
                if (!isDefined('window.Gemini')) return 'warn';
                return isFunction('window.Gemini.init') || 'warn';
            },
            'WARN: window.Gemini.init not available. Expected while ai.js is commented out.');

        await T('sec-api', 'sec-api-body',
            'Gemini.getMissionName() method',
            () => {
                if (!isDefined('window.Gemini')) return 'warn';
                return isFunction('window.Gemini.getMissionName') || 'warn';
            },
            'WARN: window.Gemini.getMissionName not available. Expected while ai.js is commented out.');

        // Async AI ping â€” gracefully skips when ai.js is not loaded
        await T('sec-api', 'sec-api-body',
            'Gemini API live ping',
            async () => {
                if (!isDefined('window.Gemini.getMissionName')) {
                    diag.log('  ! Skipping live Gemini ping â€” ai.js not loaded (expected).', 'warn');
                    return 'warn';
                }
                diag.log('  > Attempting Gemini.getMissionName()...', 'info');
                const result = await Promise.race([
                    window.Gemini.getMissionName().catch(e => { throw e; }),
                    new Promise((_, rej) => setTimeout(() => rej(new Error('Timeout after 8s')), 8000))
                ]);
                if (result !== undefined && result !== null && result !== '') {
                    diag.log('  ok AI Response received: "' + result + '"', 'success');
                    return true;
                }
                diag.log('  ! AI returned empty response.', 'warn');
                return 'warn';
            },
            'WARN: Gemini API not reachable â€” ai.js is commented out. Uncomment js/ai.js in index.html to enable.');

        await T('sec-api', 'sec-api-body',
            'localStorage available',
            () => {
                try {
                    localStorage.setItem('__mtc_diag__', '1');
                    localStorage.removeItem('__mtc_diag__');
                    return true;
                } catch { return false; }
            },
            'Failed: localStorage is not accessible. Running in private mode or storage is blocked.');

        await T('sec-api', 'sec-api-body',
            'getSaveData() function',
            () => isFunction('window.getSaveData'),
            'Failed: window.getSaveData is not a function. Check game.js or utils.js.');

        await T('sec-api', 'sec-api-body',
            'updateSaveData() function',
            () => isFunction('window.updateSaveData'),
            'Failed: window.updateSaveData is not a function. Check utils.js.');

        await delay(60);

        // â”€â”€ 6. GAME.JS CORE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        diag.sep('GAME CORE â€” game.js integration checks');

        await T('sec-game', 'sec-game-body',
            'Canvas element accessible',
            () => {
                // Check the real canvas (outside dummy wrapper) OR the dummy one
                const cv = document.getElementById('__real_canvas__') || document.getElementById('gameCanvas');
                return !!cv;
            },
            'Failed: No canvas element found in DOM. Game.js may fail on init.');

        await T('sec-game', 'sec-game-body',
            'Canvas 2D context obtainable',
            () => {
                try {
                    const cv = document.getElementById('__real_canvas__') || document.getElementById('gameCanvas');
                    return !!(cv && cv.getContext('2d'));
                } catch { return false; }
            },
            'Failed: Cannot get 2D context from canvas. Browser may not support Canvas API.');

        await T('sec-game', 'sec-game-body',
            'gameState or game global',
            () => isDefined('window.gameState') || isDefined('window.game'),
            'Failed: No game state object found. Check game.js â€” expected window.gameState or window.game.');

        await T('sec-game', 'sec-game-body',
            'startGame() function',
            () => isFunction('window.startGame'),
            'Failed: window.startGame is not a function. Check game.js. (Note: it is intercepted on this debug page.)');

        await T('sec-game', 'sec-game-body',
            'gameLoop() / requestAnimationFrame loop',
            () => isFunction('window.gameLoop') || isFunction('window.tick') || isFunction('window.update'),
            'Failed: No game loop function found. Check game.js for gameLoop(), tick(), or update().');

        await T('sec-game', 'sec-game-body',
            'endGame() function',
            () => isFunction('window.endGame'),
            'Failed: window.endGame is not a function. Check game.js.');

        await T('sec-game', 'sec-game-body',
            'Player instance in gameState',
            () => isDefined('window.gameState.player') || isDefined('window.player'),
            'Failed: No player instance in gameState. This may be OK at page load â€” run after game.init().');

        // â”€â”€ WRAP UP â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        diag.sep('COMPLETE');

        const total  = state.results.length;
        const passed = state.results.filter(r => r.status === 'pass').length;
        const failed = state.results.filter(r => r.status === 'fail').length;
        const warned  = state.results.filter(r => r.status === 'warn').length;

        diag.log(`Diagnostic complete: ${passed}/${total} passed, ${failed} failed, ${warned} warnings.`,
            failed > 0 ? 'error' : warned > 0 ? 'warn' : 'success');

        if (failed === 0 && warned === 0) {
            diag.log('âœ” All systems operational. MTC the Game Beta Edition is ready to run.', 'success');
            setStatus(`ALL SYSTEMS GO â€” ${passed}/${total} checks passed.`, true);
        } else if (failed > 0) {
            diag.log(`âœ– ${failed} system(s) failed. Review the panels above for details.`, 'error');
            setStatus(`ISSUES DETECTED â€” ${failed} failure(s), ${warned} warning(s). See panels above.`, true);
        } else {
            diag.log(`âš  ${warned} warning(s) detected. Systems functional but review recommended.`, 'warn');
            setStatus(`WARNINGS â€” ${warned} warning(s). Most systems are operational.`, true);
        }

        state.running = false;
        document.getElementById('run-btn').disabled = false;
    };

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // AUTO-RUN ON PAGE LOAD
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    window.addEventListener('load', () => {
        setTimeout(runAllDiagnostics, 600);
    });

})();
</script>

</body>
</html>